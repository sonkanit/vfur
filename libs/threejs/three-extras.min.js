// three.js - http://github.com/mrdoob/three.js
'use strict';THREE.GeometryUtils={merge:function(b,a,c){var d,e,f=b.vertices.length,g=a instanceof THREE.Mesh?a.geometry:a,h=b.vertices,i=g.vertices,j=b.faces,k=g.faces,b=b.faceVertexUvs[0],g=g.faceVertexUvs[0];void 0===c&&(c=0);a instanceof THREE.Mesh&&(a.matrixAutoUpdate&&a.updateMatrix(),d=a.matrix,e=(new THREE.Matrix3).getNormalMatrix(d));for(var a=0,n=i.length;a<n;a++){var m=i[a].clone();d&&m.applyMatrix4(d);h.push(m)}a=0;for(n=k.length;a<n;a++){var m=k[a],q,r,l=m.vertexNormals,s=m.vertexColors;
q=new THREE.Face3(m.a+f,m.b+f,m.c+f);q.normal.copy(m.normal);e&&q.normal.applyMatrix3(e).normalize();h=0;for(i=l.length;h<i;h++)r=l[h].clone(),e&&r.applyMatrix3(e).normalize(),q.vertexNormals.push(r);q.color.copy(m.color);h=0;for(i=s.length;h<i;h++)r=s[h],q.vertexColors.push(r.clone());q.materialIndex=m.materialIndex+c;q.centroid.copy(m.centroid);d&&q.centroid.applyMatrix4(d);j.push(q)}a=0;for(n=g.length;a<n;a++){c=g[a];d=[];h=0;for(i=c.length;h<i;h++)d.push(new THREE.Vector2(c[h].x,c[h].y));b.push(d)}},
randomPointInTriangle:function(){var b=new THREE.Vector3;return function(a,c,d){var e=new THREE.Vector3,f=THREE.Math.random16(),g=THREE.Math.random16();1<f+g&&(f=1-f,g=1-g);var h=1-f-g;e.copy(a);e.multiplyScalar(f);b.copy(c);b.multiplyScalar(g);e.add(b);b.copy(d);b.multiplyScalar(h);e.add(b);return e}}(),randomPointInFace:function(b,a){return THREE.GeometryUtils.randomPointInTriangle(a.vertices[b.a],a.vertices[b.b],a.vertices[b.c])},randomPointsInGeometry:function(b,a){function c(a){function b(c,
d){if(d<c)return c;var e=c+Math.floor((d-c)/2);return j[e]>a?b(c,e-1):j[e]<a?b(e+1,d):e}return b(0,j.length-1)}var d,e,f=b.faces,g=b.vertices,h=f.length,i=0,j=[],k,n,m;for(e=0;e<h;e++)d=f[e],k=g[d.a],n=g[d.b],m=g[d.c],d._area=THREE.GeometryUtils.triangleArea(k,n,m),i+=d._area,j[e]=i;d=[];for(e=0;e<a;e++)g=THREE.Math.random16()*i,g=c(g),d[e]=THREE.GeometryUtils.randomPointInFace(f[g],b,!0);return d},triangleArea:function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(c,d,e){b.subVectors(d,
c);a.subVectors(e,c);b.cross(a);return 0.5*b.length()}}(),center:function(b){b.computeBoundingBox();var a=b.boundingBox,c=new THREE.Vector3;c.addVectors(a.min,a.max);c.multiplyScalar(-0.5);b.applyMatrix((new THREE.Matrix4).makeTranslation(c.x,c.y,c.z));b.computeBoundingBox();return c},triangulateQuads:function(b){var a,c,d,e,f=[],g=[];a=0;for(c=b.faceVertexUvs.length;a<c;a++)g[a]=[];a=0;for(c=b.faces.length;a<c;a++){f.push(b.faces[a]);d=0;for(e=b.faceVertexUvs.length;d<e;d++)g[d].push(b.faceVertexUvs[d][a])}b.faces=
f;b.faceVertexUvs=g;b.computeCentroids();b.computeFaceNormals();b.computeVertexNormals();b.hasTangents&&b.computeTangents()}};THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(b,a,c){var d=new THREE.ImageLoader;d.crossOrigin=this.crossOrigin;var e=new THREE.Texture(void 0,a),a=d.load(b,function(){e.needsUpdate=!0;c&&c(e)});e.image=a;e.sourceFile=b;return e},loadCompressedTexture:function(b,a,c,d){var e=new THREE.CompressedTexture;e.mapping=a;var f=new XMLHttpRequest;f.onload=function(){var a=THREE.ImageUtils.parseDDS(f.response,!0);e.format=a.format;e.mipmaps=a.mipmaps;e.image.width=a.width;e.image.height=a.height;
e.generateMipmaps=!1;e.needsUpdate=!0;c&&c(e)};f.onerror=d;f.open("GET",b,!0);f.responseType="arraybuffer";f.send(null);return e},loadTextureCube:function(b,a,c,d){var e=[];e.loadCount=0;var f=new THREE.Texture;f.image=e;void 0!==a&&(f.mapping=a);f.flipY=!1;for(var a=0,g=b.length;a<g;++a){var h=new Image;e[a]=h;h.onload=function(){e.loadCount+=1;6===e.loadCount&&(f.needsUpdate=!0,c&&c(f))};h.onerror=d;h.crossOrigin=this.crossOrigin;h.src=b[a]}return f},loadCompressedTextureCube:function(b,a,c,d){var e=
[];e.loadCount=0;var f=new THREE.CompressedTexture;f.image=e;void 0!==a&&(f.mapping=a);f.flipY=!1;f.generateMipmaps=!1;a=function(a,b){return function(){var d=THREE.ImageUtils.parseDDS(a.response,!0);b.format=d.format;b.mipmaps=d.mipmaps;b.width=d.width;b.height=d.height;e.loadCount+=1;6===e.loadCount&&(f.format=d.format,f.needsUpdate=!0,c&&c(f))}};if(b instanceof Array)for(var g=0,h=b.length;g<h;++g){var i={};e[g]=i;var j=new XMLHttpRequest;j.onload=a(j,i);j.onerror=d;i=b[g];j.open("GET",i,!0);j.responseType=
"arraybuffer";j.send(null)}else j=new XMLHttpRequest,j.onload=function(){var a=THREE.ImageUtils.parseDDS(j.response,!0);if(a.isCubemap){for(var b=a.mipmaps.length/a.mipmapCount,d=0;d<b;d++){e[d]={mipmaps:[]};for(var g=0;g<a.mipmapCount;g++)e[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+g]),e[d].format=a.format,e[d].width=a.width,e[d].height=a.height}f.format=a.format;f.needsUpdate=!0;c&&c(f)}},j.onerror=d,j.open("GET",b,!0),j.responseType="arraybuffer",j.send(null);return f},loadDDSTexture:function(b,
a,c,d){var e=[];e.loadCount=0;var f=new THREE.CompressedTexture;f.image=e;void 0!==a&&(f.mapping=a);f.flipY=!1;f.generateMipmaps=!1;var g=new XMLHttpRequest;g.onload=function(){var a=THREE.ImageUtils.parseDDS(g.response,!0);if(a.isCubemap)for(var b=a.mipmaps.length/a.mipmapCount,d=0;d<b;d++){e[d]={mipmaps:[]};for(var k=0;k<a.mipmapCount;k++)e[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+k]),e[d].format=a.format,e[d].width=a.width,e[d].height=a.height}else f.image.width=a.width,f.image.height=a.height,
f.mipmaps=a.mipmaps;f.format=a.format;f.needsUpdate=!0;c&&c(f)};g.onerror=d;g.open("GET",b,!0);g.responseType="arraybuffer";g.send(null);return f},parseDDS:function(b,a){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}var d={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},e=c("DXT1"),f=c("DXT3"),g=c("DXT5"),h=new Int32Array(b,0,31);if(542327876!==h[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),d;if(!h[20]&
4)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),d;var i=h[21],j=!1;switch(i){case e:e=8;d.format=THREE.RGB_S3TC_DXT1_Format;break;case f:e=16;d.format=THREE.RGBA_S3TC_DXT3_Format;break;case g:e=16;d.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(32==h[22]&&h[23]&16711680&&h[24]&65280&&h[25]&255&&h[26]&4278190080)j=!0,e=64,d.format=THREE.RGBAFormat;else return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(i&
255,i>>8&255,i>>16&255,i>>24&255)),d}d.mipmapCount=1;h[2]&131072&&!1!==a&&(d.mipmapCount=Math.max(1,h[7]));d.isCubemap=h[28]&512?!0:!1;d.width=h[4];d.height=h[3];for(var h=h[1]+4,f=d.width,g=d.height,i=d.isCubemap?6:1,k=0;k<i;k++){for(var n=0;n<d.mipmapCount;n++){if(j){var m;m=f;for(var q=g,r=4*m*q,l=new Uint8Array(b,h,r),r=new Uint8Array(r),s=0,t=0,p=0;p<q;p++)for(var v=0;v<m;v++){var w=l[t];t++;var u=l[t];t++;var E=l[t];t++;var x=l[t];t++;r[s]=E;s++;r[s]=u;s++;r[s]=w;s++;r[s]=x;s++}m=r;q=m.length}else q=
Math.max(4,f)/4*Math.max(4,g)/4*e,m=new Uint8Array(b,h,q);d.mipmaps.push({data:m,width:f,height:g});h+=q;f=Math.max(0.5*f,1);g=Math.max(0.5*g,1)}f=d.width;g=d.height}return d},getNormalMap:function(b,a){var c=function(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/b,a[1]/b,a[2]/b]},a=a|1,d=b.width,e=b.height,f=document.createElement("canvas");f.width=d;f.height=e;var g=f.getContext("2d");g.drawImage(b,0,0);for(var h=g.getImageData(0,0,d,e).data,i=g.createImageData(d,e),j=i.data,k=0;k<
d;k++)for(var n=0;n<e;n++){var m=0>n-1?0:n-1,q=n+1>e-1?e-1:n+1,r=0>k-1?0:k-1,l=k+1>d-1?d-1:k+1,s=[],t=[0,0,h[4*(n*d+k)]/255*a];s.push([-1,0,h[4*(n*d+r)]/255*a]);s.push([-1,-1,h[4*(m*d+r)]/255*a]);s.push([0,-1,h[4*(m*d+k)]/255*a]);s.push([1,-1,h[4*(m*d+l)]/255*a]);s.push([1,0,h[4*(n*d+l)]/255*a]);s.push([1,1,h[4*(q*d+l)]/255*a]);s.push([0,1,h[4*(q*d+k)]/255*a]);s.push([-1,1,h[4*(q*d+r)]/255*a]);m=[];r=s.length;for(q=0;q<r;q++){var l=s[q],p=s[(q+1)%r],l=[l[0]-t[0],l[1]-t[1],l[2]-t[2]],p=[p[0]-t[0],
p[1]-t[1],p[2]-t[2]];m.push(c([l[1]*p[2]-l[2]*p[1],l[2]*p[0]-l[0]*p[2],l[0]*p[1]-l[1]*p[0]]))}s=[0,0,0];for(q=0;q<m.length;q++)s[0]+=m[q][0],s[1]+=m[q][1],s[2]+=m[q][2];s[0]/=m.length;s[1]/=m.length;s[2]/=m.length;t=4*(n*d+k);j[t]=255*((s[0]+1)/2)|0;j[t+1]=255*((s[1]+1)/2)|0;j[t+2]=255*s[2]|0;j[t+3]=255}g.putImageData(i,0,0);return f},generateDataTexture:function(b,a,c){for(var d=b*a,e=new Uint8Array(3*d),f=Math.floor(255*c.r),g=Math.floor(255*c.g),c=Math.floor(255*c.b),h=0;h<d;h++)e[3*h]=f,e[3*h+
1]=g,e[3*h+2]=c;b=new THREE.DataTexture(e,b,a,THREE.RGBFormat);b.needsUpdate=!0;return b}};THREE.SceneUtils={createMultiMaterialObject:function(b,a){for(var c=new THREE.Object3D,d=0,e=a.length;d<e;d++)c.add(new THREE.Mesh(b,a[d]));return c},detach:function(b,a,c){b.applyMatrix(a.matrixWorld);a.remove(b);c.add(b)},attach:function(b,a,c){var d=new THREE.Matrix4;d.getInverse(c.matrixWorld);b.applyMatrix(d);a.remove(b);c.add(b)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(b){var a=b.familyName.toLowerCase();this.faces[a]=this.faces[a]||{};this.faces[a][b.cssFontWeight]=this.faces[a][b.cssFontWeight]||{};this.faces[a][b.cssFontWeight][b.cssFontStyle]=b;return this.faces[a][b.cssFontWeight][b.cssFontStyle]=b},drawText:function(b){for(var a=this.getFace(),c=this.size/a.resolution,d=
0,e=String(b).split(""),f=e.length,g=[],b=0;b<f;b++){var h=new THREE.Path,h=this.extractGlyphPoints(e[b],a,c,d,h),d=d+h.offset;g.push(h.path)}return{paths:g,offset:d/2}},extractGlyphPoints:function(b,a,c,d,e){var f=[],g,h,i,j,k,n,m,q,r,l,s,t=a.glyphs[b]||a.glyphs["?"];if(t){if(t.o){a=t._cachedOutline||(t._cachedOutline=t.o.split(" "));j=a.length;for(b=0;b<j;)switch(i=a[b++],i){case "m":i=a[b++]*c+d;k=a[b++]*c;e.moveTo(i,k);break;case "l":i=a[b++]*c+d;k=a[b++]*c;e.lineTo(i,k);break;case "q":i=a[b++]*
c+d;k=a[b++]*c;q=a[b++]*c+d;r=a[b++]*c;e.quadraticCurveTo(q,r,i,k);if(g=f[f.length-1]){n=g.x;m=g.y;g=1;for(h=this.divisions;g<=h;g++){var p=g/h;THREE.Shape.Utils.b2(p,n,q,i);THREE.Shape.Utils.b2(p,m,r,k)}}break;case "b":if(i=a[b++]*c+d,k=a[b++]*c,q=a[b++]*c+d,r=a[b++]*-c,l=a[b++]*c+d,s=a[b++]*-c,e.bezierCurveTo(i,k,q,r,l,s),g=f[f.length-1]){n=g.x;m=g.y;g=1;for(h=this.divisions;g<=h;g++)p=g/h,THREE.Shape.Utils.b3(p,n,q,l,i),THREE.Shape.Utils.b3(p,m,r,s,k)}}}return{offset:t.ha*c,path:e}}}};
THREE.FontUtils.generateShapes=function(b,a){var a=a||{},c=void 0!==a.curveSegments?a.curveSegments:4,d=void 0!==a.font?a.font:"helvetiker",e=void 0!==a.weight?a.weight:"normal",f=void 0!==a.style?a.style:"normal";THREE.FontUtils.size=void 0!==a.size?a.size:100;THREE.FontUtils.divisions=c;THREE.FontUtils.face=d;THREE.FontUtils.weight=e;THREE.FontUtils.style=f;c=THREE.FontUtils.drawText(b).paths;d=[];e=0;for(f=c.length;e<f;e++)Array.prototype.push.apply(d,c[e].toShapes());return d};
(function(b){var a=function(a){for(var b=a.length,e=0,f=b-1,g=0;g<b;f=g++)e+=a[f].x*a[g].y-a[g].x*a[f].y;return 0.5*e};b.Triangulate=function(b,d){var e=b.length;if(3>e)return null;var f=[],g=[],h=[],i,j,k;if(0<a(b))for(j=0;j<e;j++)g[j]=j;else for(j=0;j<e;j++)g[j]=e-1-j;var n=2*e;for(j=e-1;2<e;){if(0>=n--){console.log("Warning, unable to triangulate polygon!");break}i=j;e<=i&&(i=0);j=i+1;e<=j&&(j=0);k=j+1;e<=k&&(k=0);var m;a:{var q=m=void 0,r=void 0,l=void 0,s=void 0,t=void 0,p=void 0,v=void 0,w=
void 0,q=b[g[i]].x,r=b[g[i]].y,l=b[g[j]].x,s=b[g[j]].y,t=b[g[k]].x,p=b[g[k]].y;if(1E-10>(l-q)*(p-r)-(s-r)*(t-q))m=!1;else{var u=void 0,E=void 0,x=void 0,A=void 0,y=void 0,F=void 0,D=void 0,J=void 0,H=void 0,K=void 0,H=J=D=w=v=void 0,u=t-l,E=p-s,x=q-t,A=r-p,y=l-q,F=s-r;for(m=0;m<e;m++)if(!(m===i||m===j||m===k))if(v=b[g[m]].x,w=b[g[m]].y,D=v-q,J=w-r,H=v-l,K=w-s,v-=t,w-=p,H=u*K-E*H,D=y*J-F*D,J=x*w-A*v,-1E-10<=H&&-1E-10<=J&&-1E-10<=D){m=!1;break a}m=!0}}if(m){f.push([b[g[i]],b[g[j]],b[g[k]]]);h.push([g[i],
g[j],g[k]]);i=j;for(k=j+1;k<e;i++,k++)g[i]=g[k];e--;n=2*e}}return d?h:f};b.Triangulate.area=a;return b})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(b){b=this.getUtoTmapping(b);return this.getPoint(b)};THREE.Curve.prototype.getPoints=function(b){b||(b=5);var a,c=[];for(a=0;a<=b;a++)c.push(this.getPoint(a/b));return c};THREE.Curve.prototype.getSpacedPoints=function(b){b||(b=5);var a,c=[];for(a=0;a<=b;a++)c.push(this.getPointAt(a/b));return c};
THREE.Curve.prototype.getLength=function(){var b=this.getLengths();return b[b.length-1]};THREE.Curve.prototype.getLengths=function(b){b||(b=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==b+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var a=[],c,d=this.getPoint(0),e,f=0;a.push(0);for(e=1;e<=b;e++)c=this.getPoint(e/b),f+=c.distanceTo(d),a.push(f),d=c;return this.cacheArcLengths=a};
THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(b,a){var c=this.getLengths(),d=0,e=c.length,f;f=a?a:b*c[e-1];for(var g=0,h=e-1,i;g<=h;)if(d=Math.floor(g+(h-g)/2),i=c[d]-f,0>i)g=d+1;else if(0<i)h=d-1;else{h=d;break}d=h;if(c[d]==f)return d/(e-1);g=c[d];return c=(d+(f-g)/(c[d+1]-g))/(e-1)};THREE.Curve.prototype.getTangent=function(b){var a=b-1E-4,b=b+1E-4;0>a&&(a=0);1<b&&(b=1);a=this.getPoint(a);return this.getPoint(b).clone().sub(a).normalize()};
THREE.Curve.prototype.getTangentAt=function(b){b=this.getUtoTmapping(b);return this.getTangent(b)};
THREE.Curve.Utils={tangentQuadraticBezier:function(b,a,c,d){return 2*(1-b)*(c-a)+2*b*(d-c)},tangentCubicBezier:function(b,a,c,d,e){return-3*a*(1-b)*(1-b)+3*c*(1-b)*(1-b)-6*b*c*(1-b)+6*b*d*(1-b)-3*b*b*d+3*b*b*e},tangentSpline:function(b){return 6*b*b-6*b+(3*b*b-4*b+1)+(-6*b*b+6*b)+(3*b*b-2*b)},interpolate:function(b,a,c,d,e){var b=0.5*(c-b),d=0.5*(d-a),f=e*e;return(2*a-2*c+b+d)*e*f+(-3*a+3*c-2*b-d)*f+b*e+a}};
THREE.Curve.create=function(b,a){b.prototype=Object.create(THREE.Curve.prototype);b.prototype.getPoint=a;return b};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=!1};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(b){this.curves.push(b)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var b=this.curves[0].getPoint(0),a=this.curves[this.curves.length-1].getPoint(1);b.equals(a)||this.curves.push(new THREE.LineCurve(a,b))};
THREE.CurvePath.prototype.getPoint=function(b){for(var a=b*this.getLength(),c=this.getCurveLengths(),b=0;b<c.length;){if(c[b]>=a)return a=c[b]-a,b=this.curves[b],a=1-a/b.getLength(),b.getPointAt(a);b++}return null};THREE.CurvePath.prototype.getLength=function(){var b=this.getCurveLengths();return b[b.length-1]};
THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var b=[],a=0,c,d=this.curves.length;for(c=0;c<d;c++)a+=this.curves[c].getLength(),b.push(a);return this.cacheLengths=b};
THREE.CurvePath.prototype.getBoundingBox=function(){var b=this.getPoints(),a,c,d,e,f,g;a=c=Number.NEGATIVE_INFINITY;e=f=Number.POSITIVE_INFINITY;var h,i,j,k,n=b[0]instanceof THREE.Vector3;k=n?new THREE.Vector3:new THREE.Vector2;i=0;for(j=b.length;i<j;i++)h=b[i],h.x>a?a=h.x:h.x<e&&(e=h.x),h.y>c?c=h.y:h.y<f&&(f=h.y),n&&(h.z>d?d=h.z:h.z<g&&(g=h.z)),k.add(h);b={minX:e,minY:f,maxX:a,maxY:c,centroid:k.divideScalar(j)};n&&(b.maxZ=d,b.minZ=g);return b};
THREE.CurvePath.prototype.createPointsGeometry=function(b){b=this.getPoints(b,!0);return this.createGeometry(b)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(b){b=this.getSpacedPoints(b,!0);return this.createGeometry(b)};THREE.CurvePath.prototype.createGeometry=function(b){for(var a=new THREE.Geometry,c=0;c<b.length;c++)a.vertices.push(new THREE.Vector3(b[c].x,b[c].y,b[c].z||0));return a};THREE.CurvePath.prototype.addWrapPath=function(b){this.bends.push(b)};
THREE.CurvePath.prototype.getTransformedPoints=function(b,a){var c=this.getPoints(b),d,e;a||(a=this.bends);d=0;for(e=a.length;d<e;d++)c=this.getWrapPoints(c,a[d]);return c};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(b,a){var c=this.getSpacedPoints(b),d,e;a||(a=this.bends);d=0;for(e=a.length;d<e;d++)c=this.getWrapPoints(c,a[d]);return c};
THREE.CurvePath.prototype.getWrapPoints=function(b,a){var c=this.getBoundingBox(),d,e,f,g,h,i;d=0;for(e=b.length;d<e;d++)f=b[d],g=f.x,h=f.y,i=g/c.maxX,i=a.getUtoTmapping(i,g),g=a.getPoint(i),i=a.getTangent(i),i.set(-i.y,i.x).multiplyScalar(h),f.x=g.x+i.x,f.y=g.y+i.y;return b};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);
THREE.Gyroscope.prototype.updateMatrixWorld=function(b){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||b)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),
this.matrixWorldNeedsUpdate=!1,b=!0;for(var a=0,c=this.children.length;a<c;a++)this.children[a].updateMatrixWorld(b)};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3;THREE.Gyroscope.prototype.translationObject=new THREE.Vector3;THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion;THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion;THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3;THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3;THREE.Path=function(b){THREE.CurvePath.call(this);this.actions=[];b&&this.fromPoints(b)};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(b){this.moveTo(b[0].x,b[0].y);for(var a=1,c=b.length;a<c;a++)this.lineTo(b[a].x,b[a].y)};
THREE.Path.prototype.moveTo=function(b,a){var c=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:c})};THREE.Path.prototype.lineTo=function(b,a){var c=Array.prototype.slice.call(arguments),d=this.actions[this.actions.length-1].args,d=new THREE.LineCurve(new THREE.Vector2(d[d.length-2],d[d.length-1]),new THREE.Vector2(b,a));this.curves.push(d);this.actions.push({action:THREE.PathActions.LINE_TO,args:c})};
THREE.Path.prototype.quadraticCurveTo=function(b,a,c,d){var e=Array.prototype.slice.call(arguments),f=this.actions[this.actions.length-1].args,f=new THREE.QuadraticBezierCurve(new THREE.Vector2(f[f.length-2],f[f.length-1]),new THREE.Vector2(b,a),new THREE.Vector2(c,d));this.curves.push(f);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:e})};
THREE.Path.prototype.bezierCurveTo=function(b,a,c,d,e,f){var g=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,h=new THREE.CubicBezierCurve(new THREE.Vector2(h[h.length-2],h[h.length-1]),new THREE.Vector2(b,a),new THREE.Vector2(c,d),new THREE.Vector2(e,f));this.curves.push(h);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:g})};
THREE.Path.prototype.splineThru=function(b){var a=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,c=[new THREE.Vector2(c[c.length-2],c[c.length-1])];Array.prototype.push.apply(c,b);c=new THREE.SplineCurve(c);this.curves.push(c);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:a})};THREE.Path.prototype.arc=function(b,a,c,d,e,f){var g=this.actions[this.actions.length-1].args;this.absarc(b+g[g.length-2],a+g[g.length-1],c,d,e,f)};
THREE.Path.prototype.absarc=function(b,a,c,d,e,f){this.absellipse(b,a,c,c,d,e,f)};THREE.Path.prototype.ellipse=function(b,a,c,d,e,f,g){var h=this.actions[this.actions.length-1].args;this.absellipse(b+h[h.length-2],a+h[h.length-1],c,d,e,f,g)};THREE.Path.prototype.absellipse=function(b,a,c,d,e,f,g){var h=Array.prototype.slice.call(arguments),i=new THREE.EllipseCurve(b,a,c,d,e,f,g);this.curves.push(i);i=i.getPoint(1);h.push(i.x);h.push(i.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:h})};
THREE.Path.prototype.getSpacedPoints=function(b){b||(b=40);for(var a=[],c=0;c<b;c++)a.push(this.getPoint(c/b));return a};
THREE.Path.prototype.getPoints=function(b,a){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(b,a);var b=b||12,c=[],d,e,f,g,h,i,j,k,n,m,q,r,l;d=0;for(e=this.actions.length;d<e;d++)switch(f=this.actions[d],g=f.action,f=f.args,g){case THREE.PathActions.MOVE_TO:c.push(new THREE.Vector2(f[0],f[1]));break;case THREE.PathActions.LINE_TO:c.push(new THREE.Vector2(f[0],f[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:h=f[2];i=f[3];n=f[0];m=f[1];0<c.length?(g=c[c.length-1],q=g.x,
r=g.y):(g=this.actions[d-1].args,q=g[g.length-2],r=g[g.length-1]);for(f=1;f<=b;f++)l=f/b,g=THREE.Shape.Utils.b2(l,q,n,h),l=THREE.Shape.Utils.b2(l,r,m,i),c.push(new THREE.Vector2(g,l));break;case THREE.PathActions.BEZIER_CURVE_TO:h=f[4];i=f[5];n=f[0];m=f[1];j=f[2];k=f[3];0<c.length?(g=c[c.length-1],q=g.x,r=g.y):(g=this.actions[d-1].args,q=g[g.length-2],r=g[g.length-1]);for(f=1;f<=b;f++)l=f/b,g=THREE.Shape.Utils.b3(l,q,n,j,h),l=THREE.Shape.Utils.b3(l,r,m,k,i),c.push(new THREE.Vector2(g,l));break;case THREE.PathActions.CSPLINE_THRU:g=
this.actions[d-1].args;l=[new THREE.Vector2(g[g.length-2],g[g.length-1])];g=b*f[0].length;l=l.concat(f[0]);l=new THREE.SplineCurve(l);for(f=1;f<=g;f++)c.push(l.getPointAt(f/g));break;case THREE.PathActions.ARC:h=f[0];i=f[1];m=f[2];j=f[3];g=f[4];n=!!f[5];q=g-j;r=2*b;for(f=1;f<=r;f++)l=f/r,n||(l=1-l),l=j+l*q,g=h+m*Math.cos(l),l=i+m*Math.sin(l),c.push(new THREE.Vector2(g,l));break;case THREE.PathActions.ELLIPSE:h=f[0];i=f[1];m=f[2];k=f[3];j=f[4];g=f[5];n=!!f[6];q=g-j;r=2*b;for(f=1;f<=r;f++)l=f/r,n||
(l=1-l),l=j+l*q,g=h+m*Math.cos(l),l=i+k*Math.sin(l),c.push(new THREE.Vector2(g,l))}d=c[c.length-1];1E-10>Math.abs(d.x-c[0].x)&&1E-10>Math.abs(d.y-c[0].y)&&c.splice(c.length-1,1);a&&c.push(c[0]);return c};
THREE.Path.prototype.toShapes=function(b){var a,c,d,e,f=[],g=new THREE.Path;a=0;for(c=this.actions.length;a<c;a++)d=this.actions[a],e=d.args,d=d.action,d==THREE.PathActions.MOVE_TO&&0!=g.actions.length&&(f.push(g),g=new THREE.Path),g[d].apply(g,e);0!=g.actions.length&&f.push(g);if(0==f.length)return[];var h;e=[];if(1==f.length)return d=f[0],h=new THREE.Shape,h.actions=d.actions,h.curves=d.curves,e.push(h),e;a=!THREE.Shape.Utils.isClockWise(f[0].getPoints());if(b?!a:a){h=new THREE.Shape;a=0;for(c=
f.length;a<c;a++)d=f[a],g=THREE.Shape.Utils.isClockWise(d.getPoints()),(g=b?!g:g)?(h.actions=d.actions,h.curves=d.curves,e.push(h),h=new THREE.Shape):h.holes.push(d)}else{h=void 0;a=0;for(c=f.length;a<c;a++)d=f[a],g=THREE.Shape.Utils.isClockWise(d.getPoints()),(g=b?!g:g)?(h&&e.push(h),h=new THREE.Shape,h.actions=d.actions,h.curves=d.curves):h.holes.push(d);e.push(h)}return e};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(b){return new THREE.ExtrudeGeometry(this,b)};THREE.Shape.prototype.makeGeometry=function(b){return new THREE.ShapeGeometry(this,b)};THREE.Shape.prototype.getPointsHoles=function(b){var a,c=this.holes.length,d=[];for(a=0;a<c;a++)d[a]=this.holes[a].getTransformedPoints(b,this.bends);return d};
THREE.Shape.prototype.getSpacedPointsHoles=function(b){var a,c=this.holes.length,d=[];for(a=0;a<c;a++)d[a]=this.holes[a].getTransformedSpacedPoints(b,this.bends);return d};THREE.Shape.prototype.extractAllPoints=function(b){return{shape:this.getTransformedPoints(b),holes:this.getPointsHoles(b)}};THREE.Shape.prototype.extractPoints=function(b){return this.useSpacedPoints?this.extractAllSpacedPoints(b):this.extractAllPoints(b)};
THREE.Shape.prototype.extractAllSpacedPoints=function(b){return{shape:this.getTransformedSpacedPoints(b),holes:this.getSpacedPointsHoles(b)}};
THREE.Shape.Utils={removeHoles:function(b,a){var c=b.concat(),d=c.concat(),e,f,g,h,i,j,k,n,m,q,r=[];for(i=0;i<a.length;i++){j=a[i];Array.prototype.push.apply(d,j);f=Number.POSITIVE_INFINITY;for(e=0;e<j.length;e++){m=j[e];q=[];for(n=0;n<c.length;n++)k=c[n],k=m.distanceToSquared(k),q.push(k),k<f&&(f=k,g=e,h=n)}e=0<=h-1?h-1:c.length-1;f=0<=g-1?g-1:j.length-1;var l=[j[g],c[h],c[e]];n=THREE.FontUtils.Triangulate.area(l);var s=[j[g],j[f],c[h]];m=THREE.FontUtils.Triangulate.area(s);q=h;k=g;h+=1;g+=-1;0>
h&&(h+=c.length);h%=c.length;0>g&&(g+=j.length);g%=j.length;e=0<=h-1?h-1:c.length-1;f=0<=g-1?g-1:j.length-1;l=[j[g],c[h],c[e]];l=THREE.FontUtils.Triangulate.area(l);s=[j[g],j[f],c[h]];s=THREE.FontUtils.Triangulate.area(s);n+m>l+s&&(h=q,g=k,0>h&&(h+=c.length),h%=c.length,0>g&&(g+=j.length),g%=j.length,e=0<=h-1?h-1:c.length-1,f=0<=g-1?g-1:j.length-1);n=c.slice(0,h);m=c.slice(h);q=j.slice(g);k=j.slice(0,g);f=[j[g],j[f],c[h]];r.push([j[g],c[h],c[e]]);r.push(f);c=n.concat(q).concat(k).concat(m)}return{shape:c,
isolatedPts:r,allpoints:d}},triangulateShape:function(b,a){var c=THREE.Shape.Utils.removeHoles(b,a),d=c.allpoints,e=c.isolatedPts,c=THREE.FontUtils.Triangulate(c.shape,!1),f,g,h,i,j={};f=0;for(g=d.length;f<g;f++)i=d[f].x+":"+d[f].y,void 0!==j[i]&&console.log("Duplicate point",i),j[i]=f;f=0;for(g=c.length;f<g;f++){h=c[f];for(d=0;3>d;d++)i=h[d].x+":"+h[d].y,i=j[i],void 0!==i&&(h[d]=i)}f=0;for(g=e.length;f<g;f++){h=e[f];for(d=0;3>d;d++)i=h[d].x+":"+h[d].y,i=j[i],void 0!==i&&(h[d]=i)}return c.concat(e)},
isClockWise:function(b){return 0>THREE.FontUtils.Triangulate.area(b)},b2p0:function(b,a){var c=1-b;return c*c*a},b2p1:function(b,a){return 2*(1-b)*b*a},b2p2:function(b,a){return b*b*a},b2:function(b,a,c,d){return this.b2p0(b,a)+this.b2p1(b,c)+this.b2p2(b,d)},b3p0:function(b,a){var c=1-b;return c*c*c*a},b3p1:function(b,a){var c=1-b;return 3*c*c*b*a},b3p2:function(b,a){return 3*(1-b)*b*b*a},b3p3:function(b,a){return b*b*b*a},b3:function(b,a,c,d,e){return this.b3p0(b,a)+this.b3p1(b,c)+this.b3p2(b,d)+
this.b3p3(b,e)}};THREE.LineCurve=function(b,a){this.v1=b;this.v2=a};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(b){var a=this.v2.clone().sub(this.v1);a.multiplyScalar(b).add(this.v1);return a};THREE.LineCurve.prototype.getPointAt=function(b){return this.getPoint(b)};THREE.LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()};THREE.QuadraticBezierCurve=function(b,a,c){this.v0=b;this.v1=a;this.v2=c};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(b){var a;a=THREE.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);b=THREE.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(a,b)};
THREE.QuadraticBezierCurve.prototype.getTangent=function(b){var a;a=THREE.Curve.Utils.tangentQuadraticBezier(b,this.v0.x,this.v1.x,this.v2.x);b=THREE.Curve.Utils.tangentQuadraticBezier(b,this.v0.y,this.v1.y,this.v2.y);a=new THREE.Vector2(a,b);a.normalize();return a};THREE.CubicBezierCurve=function(b,a,c,d){this.v0=b;this.v1=a;this.v2=c;this.v3=d};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.getPoint=function(b){var a;a=THREE.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=THREE.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(a,b)};
THREE.CubicBezierCurve.prototype.getTangent=function(b){var a;a=THREE.Curve.Utils.tangentCubicBezier(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);b=THREE.Curve.Utils.tangentCubicBezier(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);a=new THREE.Vector2(a,b);a.normalize();return a};THREE.SplineCurve=function(b){this.points=void 0==b?[]:b};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(b){var a=new THREE.Vector2,c=[],d=this.points,e;e=(d.length-1)*b;b=Math.floor(e);e-=b;c[0]=0==b?b:b-1;c[1]=b;c[2]=b>d.length-2?d.length-1:b+1;c[3]=b>d.length-3?d.length-1:b+2;a.x=THREE.Curve.Utils.interpolate(d[c[0]].x,d[c[1]].x,d[c[2]].x,d[c[3]].x,e);a.y=THREE.Curve.Utils.interpolate(d[c[0]].y,d[c[1]].y,d[c[2]].y,d[c[3]].y,e);return a};THREE.EllipseCurve=function(b,a,c,d,e,f,g){this.aX=b;this.aY=a;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);
THREE.EllipseCurve.prototype.getPoint=function(b){var a;a=this.aEndAngle-this.aStartAngle;0>a&&(a+=2*Math.PI);a>2*Math.PI&&(a-=2*Math.PI);a=!0===this.aClockwise?this.aEndAngle+(1-b)*(2*Math.PI-a):this.aStartAngle+b*a;b=this.aX+this.xRadius*Math.cos(a);a=this.aY+this.yRadius*Math.sin(a);return new THREE.Vector2(b,a)};THREE.ArcCurve=function(b,a,c,d,e,f){THREE.EllipseCurve.call(this,b,a,c,c,d,e,f)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.LineCurve3=THREE.Curve.create(function(b,a){this.v1=b;this.v2=a},function(b){var a=new THREE.Vector3;a.subVectors(this.v2,this.v1);a.multiplyScalar(b);a.add(this.v1);return a});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(b,a,c){this.v0=b;this.v1=a;this.v2=c},function(b){var a,c;a=THREE.Shape.Utils.b2(b,this.v0.x,this.v1.x,this.v2.x);c=THREE.Shape.Utils.b2(b,this.v0.y,this.v1.y,this.v2.y);b=THREE.Shape.Utils.b2(b,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(a,c,b)});THREE.CubicBezierCurve3=THREE.Curve.create(function(b,a,c,d){this.v0=b;this.v1=a;this.v2=c;this.v3=d},function(b){var a,c;a=THREE.Shape.Utils.b3(b,this.v0.x,this.v1.x,this.v2.x,this.v3.x);c=THREE.Shape.Utils.b3(b,this.v0.y,this.v1.y,this.v2.y,this.v3.y);b=THREE.Shape.Utils.b3(b,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(a,c,b)});THREE.SplineCurve3=THREE.Curve.create(function(b){this.points=void 0==b?[]:b},function(b){var a=new THREE.Vector3,c=[],d=this.points,e,b=(d.length-1)*b;e=Math.floor(b);b-=e;c[0]=0==e?e:e-1;c[1]=e;c[2]=e>d.length-2?d.length-1:e+1;c[3]=e>d.length-3?d.length-1:e+2;e=d[c[0]];var f=d[c[1]],g=d[c[2]],c=d[c[3]];a.x=THREE.Curve.Utils.interpolate(e.x,f.x,g.x,c.x,b);a.y=THREE.Curve.Utils.interpolate(e.y,f.y,g.y,c.y,b);a.z=THREE.Curve.Utils.interpolate(e.z,f.z,g.z,c.z,b);return a});THREE.ClosedSplineCurve3=THREE.Curve.create(function(b){this.points=void 0==b?[]:b},function(b){var a=new THREE.Vector3,c=[],d=this.points,e;e=(d.length-0)*b;b=Math.floor(e);e-=b;b+=0<b?0:(Math.floor(Math.abs(b)/d.length)+1)*d.length;c[0]=(b-1)%d.length;c[1]=b%d.length;c[2]=(b+1)%d.length;c[3]=(b+2)%d.length;a.x=THREE.Curve.Utils.interpolate(d[c[0]].x,d[c[1]].x,d[c[2]].x,d[c[3]].x,e);a.y=THREE.Curve.Utils.interpolate(d[c[0]].y,d[c[1]].y,d[c[2]].y,d[c[3]].y,e);a.z=THREE.Curve.Utils.interpolate(d[c[0]].z,
d[c[1]].z,d[c[2]].z,d[c[3]].z,e);return a});THREE.AnimationHandler=function(){var b=[],a={},c={update:function(a){for(var c=0;c<b.length;c++)b[c].update(a)},addToUpdate:function(a){-1===b.indexOf(a)&&b.push(a)},removeFromUpdate:function(a){a=b.indexOf(a);-1!==a&&b.splice(a,1)},add:function(b){void 0!==a[b.name]&&console.log("THREE.AnimationHandler.add: Warning! "+b.name+" already exists in library. Overwriting.");a[b.name]=b;if(!0!==b.initialized){for(var c=0;c<b.hierarchy.length;c++){for(var d=0;d<b.hierarchy[c].keys.length;d++)if(0>b.hierarchy[c].keys[d].time&&
(b.hierarchy[c].keys[d].time=0),void 0!==b.hierarchy[c].keys[d].rot&&!(b.hierarchy[c].keys[d].rot instanceof THREE.Quaternion)){var h=b.hierarchy[c].keys[d].rot;b.hierarchy[c].keys[d].rot=new THREE.Quaternion(h[0],h[1],h[2],h[3])}if(b.hierarchy[c].keys.length&&void 0!==b.hierarchy[c].keys[0].morphTargets){h={};for(d=0;d<b.hierarchy[c].keys.length;d++)for(var i=0;i<b.hierarchy[c].keys[d].morphTargets.length;i++){var j=b.hierarchy[c].keys[d].morphTargets[i];h[j]=-1}b.hierarchy[c].usedMorphTargets=h;
for(d=0;d<b.hierarchy[c].keys.length;d++){var k={};for(j in h){for(i=0;i<b.hierarchy[c].keys[d].morphTargets.length;i++)if(b.hierarchy[c].keys[d].morphTargets[i]===j){k[j]=b.hierarchy[c].keys[d].morphTargetsInfluences[i];break}i===b.hierarchy[c].keys[d].morphTargets.length&&(k[j]=0)}b.hierarchy[c].keys[d].morphTargetsInfluences=k}}for(d=1;d<b.hierarchy[c].keys.length;d++)b.hierarchy[c].keys[d].time===b.hierarchy[c].keys[d-1].time&&(b.hierarchy[c].keys.splice(d,1),d--);for(d=0;d<b.hierarchy[c].keys.length;d++)b.hierarchy[c].keys[d].index=
d}d=parseInt(b.length*b.fps,10);b.JIT={};b.JIT.hierarchy=[];for(c=0;c<b.hierarchy.length;c++)b.JIT.hierarchy.push(Array(d));b.initialized=!0}},get:function(b){if("string"===typeof b){if(a[b])return a[b];console.log("THREE.AnimationHandler.get: Couldn't find animation "+b);return null}},parse:function(a){var b=[];if(a instanceof THREE.SkinnedMesh)for(var c=0;c<a.bones.length;c++)b.push(a.bones[c]);else d(a,b);return b}},d=function(a,b){b.push(a);for(var c=0;c<a.children.length;c++)d(a.children[c],
b)};c.LINEAR=0;c.CATMULLROM=1;c.CATMULLROM_FORWARD=2;return c}();THREE.Animation=function(b,a,c){this.root=b;this.data=THREE.AnimationHandler.get(a);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=void 0!==c?c:THREE.AnimationHandler.LINEAR;this.points=[];this.target=new THREE.Vector3};
THREE.Animation.prototype.play=function(b,a){if(!1===this.isPlaying){this.isPlaying=!0;this.loop=void 0!==b?b:!0;this.currentTime=void 0!==a?a:0;var c,d=this.hierarchy.length,e;for(c=0;c<d;c++){e=this.hierarchy[c];e.matrixAutoUpdate=!0;void 0===e.animationCache&&(e.animationCache={},e.animationCache.prevKey={pos:0,rot:0,scl:0},e.animationCache.nextKey={pos:0,rot:0,scl:0},e.animationCache.originalMatrix=e instanceof THREE.Bone?e.skinMatrix:e.matrix);var f=e.animationCache.prevKey;e=e.animationCache.nextKey;
f.pos=this.data.hierarchy[c].keys[0];f.rot=this.data.hierarchy[c].keys[0];f.scl=this.data.hierarchy[c].keys[0];e.pos=this.getNextKeyWith("pos",c,1);e.rot=this.getNextKeyWith("rot",c,1);e.scl=this.getNextKeyWith("scl",c,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};THREE.Animation.prototype.pause=function(){!0===this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.removeFromUpdate(this)};
THREE.Animation.prototype.update=function(b){if(!1!==this.isPlaying){var a=["pos","rot","scl"],c,d,e,f,g,h,i,j,k;for(k=this.currentTime+=b*this.timeScale;this.currentTime>this.data.length;)this.currentTime-=this.data.length;j=this.currentTime%=this.data.length;parseInt(Math.min(j*this.data.fps,this.data.length*this.data.fps),10);for(var n=0,m=this.hierarchy.length;n<m;n++){b=this.hierarchy[n];i=b.animationCache;for(var q=0;3>q;q++){c=a[q];g=i.prevKey[c];h=i.nextKey[c];if(h.time<=k){if(j<=k)if(this.loop){g=
this.data.hierarchy[n].keys[0];for(h=this.getNextKeyWith(c,n,1);null!==h&&h.time<j&&h.index>g.index;)g=h,h=this.getNextKeyWith(c,n,h.index+1)}else{this.stop();return}else{do g=h,h=this.getNextKeyWith(c,n,h.index+1);while(null!==h&&h.time<j&&h.index>g.index)}i.prevKey[c]=g;i.nextKey[c]=h}b.matrixAutoUpdate=!0;b.matrixWorldNeedsUpdate=!0;d=(j-g.time)/(h.time-g.time);e=g[c];f=h[c];if(0>d||1<d)console.log("THREE.Animation.update: Warning! Scale out of bounds:"+d+" on bone "+n),d=0>d?0:1;if("pos"===c)if(c=
b.position,this.interpolationType===THREE.AnimationHandler.LINEAR)c.x=e[0]+(f[0]-e[0])*d,c.y=e[1]+(f[1]-e[1])*d,c.z=e[2]+(f[2]-e[2])*d;else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)this.points[0]=this.getPrevKeyWith("pos",n,g.index-1).pos,this.points[1]=e,this.points[2]=f,this.points[3]=this.getNextKeyWith("pos",n,h.index+1).pos,d=0.33*d+0.33,e=this.interpolateCatmullRom(this.points,d),c.x=e[0],c.y=e[1],c.z=e[2],
this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(d=this.interpolateCatmullRom(this.points,1.01*d),this.target.set(d[0],d[1],d[2]),this.target.sub(c),this.target.y=0,this.target.normalize(),d=Math.atan2(this.target.x,this.target.z),b.rotation.set(0,d,0))}else"rot"===c?THREE.Quaternion.slerp(e,f,b.quaternion,d):"scl"===c&&(c=b.scale,c.x=e[0]+(f[0]-e[0])*d,c.y=e[1]+(f[1]-e[1])*d,c.z=e[2]+(f[2]-e[2])*d)}}}};
THREE.Animation.prototype.interpolateCatmullRom=function(b,a){var c=[],d=[],e,f,g,h,i,j;e=(b.length-1)*a;f=Math.floor(e);e-=f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>b.length-2?f:f+1;c[3]=f>b.length-3?f:f+2;f=b[c[0]];h=b[c[1]];i=b[c[2]];j=b[c[3]];c=e*e;g=e*c;d[0]=this.interpolate(f[0],h[0],i[0],j[0],e,c,g);d[1]=this.interpolate(f[1],h[1],i[1],j[1],e,c,g);d[2]=this.interpolate(f[2],h[2],i[2],j[2],e,c,g);return d};
THREE.Animation.prototype.interpolate=function(b,a,c,d,e,f,g){b=0.5*(c-b);d=0.5*(d-a);return(2*(a-c)+b+d)*g+(-3*(a-c)-2*b-d)*f+b*e+a};THREE.Animation.prototype.getNextKeyWith=function(b,a,c){for(var d=this.data.hierarchy[a].keys,c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?c<d.length-1?c:d.length-1:c%d.length;c<d.length;c++)if(void 0!==d[c][b])return d[c];return this.data.hierarchy[a].keys[0]};
THREE.Animation.prototype.getPrevKeyWith=function(b,a,c){for(var d=this.data.hierarchy[a].keys,c=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<c?c:0:0<=c?c:c+d.length;0<=c;c--)if(void 0!==d[c][b])return d[c];return this.data.hierarchy[a].keys[d.length-1]};THREE.KeyFrameAnimation=function(b,a,c){this.root=b;this.data=THREE.AnimationHandler.get(a);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=0.001;this.isPlaying=!1;this.loop=this.isPaused=!0;this.JITCompile=void 0!==c?c:!0;b=0;for(a=this.hierarchy.length;b<a;b++){var c=this.data.hierarchy[b].sids,d=this.hierarchy[b];if(this.data.hierarchy[b].keys.length&&c){for(var e=0;e<c.length;e++){var f=c[e],g=this.getNextKeyWith(f,b,0);g&&g.apply(f)}d.matrixAutoUpdate=!1;this.data.hierarchy[b].node.updateMatrix();
d.matrixWorldNeedsUpdate=!0}}};
THREE.KeyFrameAnimation.prototype.play=function(b,a){if(!this.isPlaying){this.isPlaying=!0;this.loop=void 0!==b?b:!0;this.currentTime=void 0!==a?a:0;this.startTimeMs=a;this.startTime=1E7;this.endTime=-this.startTime;var c,d=this.hierarchy.length,e,f;for(c=0;c<d;c++)e=this.hierarchy[c],f=this.data.hierarchy[c],void 0===f.animationCache&&(f.animationCache={},f.animationCache.prevKey=null,f.animationCache.nextKey=null,f.animationCache.originalMatrix=e instanceof THREE.Bone?e.skinMatrix:e.matrix),e=this.data.hierarchy[c].keys,
e.length&&(f.animationCache.prevKey=e[0],f.animationCache.nextKey=e[1],this.startTime=Math.min(e[0].time,this.startTime),this.endTime=Math.max(e[e.length-1].time,this.endTime));this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};
THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.data.hierarchy.length;b++){var a=this.hierarchy[b],c=this.data.hierarchy[b];if(void 0!==c.animationCache){var d=c.animationCache.originalMatrix;a instanceof THREE.Bone?(d.copy(a.skinMatrix),a.skinMatrix=d):(d.copy(a.matrix),a.matrix=d);delete c.animationCache}}};
THREE.KeyFrameAnimation.prototype.update=function(b){if(this.isPlaying){var a,c,d,e,f=this.data.JIT.hierarchy,g,h,i;h=this.currentTime+=b*this.timeScale;g=this.currentTime%=this.data.length;g<this.startTimeMs&&(g=this.currentTime=this.startTimeMs+g);e=parseInt(Math.min(g*this.data.fps,this.data.length*this.data.fps),10);if((i=g<h)&&!this.loop){for(var b=0,j=this.hierarchy.length;b<j;b++){var k=this.data.hierarchy[b].keys,f=this.data.hierarchy[b].sids;d=k.length-1;e=this.hierarchy[b];if(k.length){for(k=
0;k<f.length;k++)g=f[k],(h=this.getPrevKeyWith(g,b,d))&&h.apply(g);this.data.hierarchy[b].node.updateMatrix();e.matrixWorldNeedsUpdate=!0}}this.stop()}else if(!(g<this.startTime)){b=0;for(j=this.hierarchy.length;b<j;b++){d=this.hierarchy[b];a=this.data.hierarchy[b];var k=a.keys,n=a.animationCache;if(this.JITCompile&&void 0!==f[b][e])d instanceof THREE.Bone?(d.skinMatrix=f[b][e],d.matrixWorldNeedsUpdate=!1):(d.matrix=f[b][e],d.matrixWorldNeedsUpdate=!0);else if(k.length){this.JITCompile&&n&&(d instanceof
THREE.Bone?d.skinMatrix=n.originalMatrix:d.matrix=n.originalMatrix);a=n.prevKey;c=n.nextKey;if(a&&c){if(c.time<=h){if(i&&this.loop){a=k[0];for(c=k[1];c.time<g;)a=c,c=k[a.index+1]}else if(!i)for(var m=k.length-1;c.time<g&&c.index!==m;)a=c,c=k[a.index+1];n.prevKey=a;n.nextKey=c}c.time>=g?a.interpolate(c,g):a.interpolate(c,c.time)}this.data.hierarchy[b].node.updateMatrix();d.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===f[0][e]){this.hierarchy[0].updateMatrixWorld(!0);for(b=0;b<this.hierarchy.length;b++)f[b][e]=
this.hierarchy[b]instanceof THREE.Bone?this.hierarchy[b].skinMatrix.clone():this.hierarchy[b].matrix.clone()}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(b,a,c){a=this.data.hierarchy[a].keys;for(c%=a.length;c<a.length;c++)if(a[c].hasTarget(b))return a[c];return a[0]};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(b,a,c){a=this.data.hierarchy[a].keys;for(c=0<=c?c:c+a.length;0<=c;c--)if(a[c].hasTarget(b))return a[c];return a[a.length-1]};THREE.CubeCamera=function(b,a,c){THREE.Object3D.call(this);var d=new THREE.PerspectiveCamera(90,1,b,a);d.up.set(0,-1,0);d.lookAt(new THREE.Vector3(1,0,0));this.add(d);var e=new THREE.PerspectiveCamera(90,1,b,a);e.up.set(0,-1,0);e.lookAt(new THREE.Vector3(-1,0,0));this.add(e);var f=new THREE.PerspectiveCamera(90,1,b,a);f.up.set(0,0,1);f.lookAt(new THREE.Vector3(0,1,0));this.add(f);var g=new THREE.PerspectiveCamera(90,1,b,a);g.up.set(0,0,-1);g.lookAt(new THREE.Vector3(0,-1,0));this.add(g);var h=new THREE.PerspectiveCamera(90,
1,b,a);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,1));this.add(h);var i=new THREE.PerspectiveCamera(90,1,b,a);i.up.set(0,-1,0);i.lookAt(new THREE.Vector3(0,0,-1));this.add(i);this.renderTarget=new THREE.WebGLRenderTargetCube(c,c,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(a,b){var c=this.renderTarget,m=c.generateMipmaps;c.generateMipmaps=!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=
2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.generateMipmaps=m;c.activeCubeFace=5;a.render(b,i,c)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CombinedCamera=function(b,a,c,d,e,f,g){THREE.Camera.call(this);this.fov=c;this.left=-b/2;this.right=b/2;this.top=a/2;this.bottom=-a/2;this.cameraO=new THREE.OrthographicCamera(b/-2,b/2,a/2,a/-2,f,g);this.cameraP=new THREE.PerspectiveCamera(c,b/a,d,e);this.zoom=1;this.toPerspective()};THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype);
THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=!0;this.inOrthographicMode=!1};
THREE.CombinedCamera.prototype.toOrthographic=function(){var b=this.cameraP.aspect,a=(this.cameraP.near+this.cameraP.far)/2,a=Math.tan(this.fov/2)*a,b=2*a*b/2,a=a/this.zoom,b=b/this.zoom;this.cameraO.left=-b;this.cameraO.right=b;this.cameraO.top=a;this.cameraO.bottom=-a;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=!1;this.inOrthographicMode=!0};
THREE.CombinedCamera.prototype.setSize=function(b,a){this.cameraP.aspect=b/a;this.left=-b/2;this.right=b/2;this.top=a/2;this.bottom=-a/2};THREE.CombinedCamera.prototype.setFov=function(b){this.fov=b;this.inPerspectiveMode?this.toPerspective():this.toOrthographic()};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())};
THREE.CombinedCamera.prototype.setLens=function(b,a){void 0===a&&(a=24);var c=2*THREE.Math.radToDeg(Math.atan(a/(2*b)));this.setFov(c);return c};THREE.CombinedCamera.prototype.setZoom=function(b){this.zoom=b;this.inPerspectiveMode?this.toPerspective():this.toOrthographic()};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};
THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=!1};
THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=!1};THREE.CircleGeometry=function(b,a,c,d){THREE.Geometry.call(this);this.radius=b=b||50;this.segments=a=void 0!==a?Math.max(3,a):8;this.thetaStart=c=void 0!==c?c:0;this.thetaLength=d=void 0!==d?d:2*Math.PI;var e,f=[];e=new THREE.Vector3;var g=new THREE.Vector2(0.5,0.5);this.vertices.push(e);f.push(g);for(e=0;e<=a;e++){var h=new THREE.Vector3,i=c+e/a*d;h.x=b*Math.cos(i);h.y=b*Math.sin(i);this.vertices.push(h);f.push(new THREE.Vector2((h.x/b+1)/2,(h.y/b+1)/2))}c=new THREE.Vector3(0,0,1);for(e=1;e<=a;e++)this.faces.push(new THREE.Face3(e,
e+1,0,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([f[e].clone(),f[e+1].clone(),g.clone()]);this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,b)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=function(b,a,c,d,e,f){function g(a,b,c,d,e,f,g,l){var s,t=h.widthSegments,p=h.heightSegments,v=e/2,w=f/2,u=h.vertices.length;if("x"===a&&"y"===b||"y"===a&&"x"===b)s="z";else if("x"===a&&"z"===b||"z"===a&&"x"===b)s="y",p=h.depthSegments;else if("z"===a&&"y"===b||"y"===a&&"z"===b)s="x",t=h.depthSegments;var E=t+1,x=p+1,A=e/t,y=f/p,F=new THREE.Vector3;F[s]=0<g?1:-1;for(e=0;e<x;e++)for(f=0;f<E;f++){var D=new THREE.Vector3;D[a]=(f*A-v)*c;D[b]=(e*y-w)*d;D[s]=g;h.vertices.push(D)}for(e=
0;e<p;e++)for(f=0;f<t;f++)w=f+E*e,a=f+E*(e+1),b=f+1+E*(e+1),c=f+1+E*e,d=new THREE.Vector2(f/t,1-e/p),g=new THREE.Vector2(f/t,1-(e+1)/p),s=new THREE.Vector2((f+1)/t,1-(e+1)/p),v=new THREE.Vector2((f+1)/t,1-e/p),w=new THREE.Face3(w+u,a+u,c+u),w.normal.copy(F),w.vertexNormals.push(F.clone(),F.clone(),F.clone()),w.materialIndex=l,h.faces.push(w),h.faceVertexUvs[0].push([d,g,v]),w=new THREE.Face3(a+u,b+u,c+u),w.normal.copy(F),w.vertexNormals.push(F.clone(),F.clone(),F.clone()),w.materialIndex=l,h.faces.push(w),
h.faceVertexUvs[0].push([g.clone(),s,v.clone()])}THREE.Geometry.call(this);var h=this;this.width=b;this.height=a;this.depth=c;this.widthSegments=d||1;this.heightSegments=e||1;this.depthSegments=f||1;b=this.width/2;a=this.height/2;c=this.depth/2;g("z","y",-1,-1,this.depth,this.height,b,0);g("z","y",1,-1,this.depth,this.height,-b,1);g("x","z",1,1,this.width,this.depth,a,2);g("x","z",1,-1,this.width,this.depth,-a,3);g("x","y",1,-1,this.width,this.height,c,4);g("x","y",-1,-1,this.width,this.height,-c,
5);this.computeCentroids();this.mergeVertices()};THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry=function(b,a,c,d,e,f){THREE.Geometry.call(this);this.radiusTop=b=void 0!==b?b:20;this.radiusBottom=a=void 0!==a?a:20;this.height=c=void 0!==c?c:100;this.radialSegments=d=d||8;this.heightSegments=e=e||1;this.openEnded=f=void 0!==f?f:!1;var g=c/2,h,i,j=[],k=[];for(i=0;i<=e;i++){var n=[],m=[],q=i/e,r=q*(a-b)+b;for(h=0;h<=d;h++){var l=h/d,s=new THREE.Vector3;s.x=r*Math.sin(2*l*Math.PI);s.y=-q*c+g;s.z=r*Math.cos(2*l*Math.PI);this.vertices.push(s);n.push(this.vertices.length-1);m.push(new THREE.Vector2(l,
1-q))}j.push(n);k.push(m)}c=(a-b)/c;for(h=0;h<d;h++){0!==b?(n=this.vertices[j[0][h]].clone(),m=this.vertices[j[0][h+1]].clone()):(n=this.vertices[j[1][h]].clone(),m=this.vertices[j[1][h+1]].clone());n.setY(Math.sqrt(n.x*n.x+n.z*n.z)*c).normalize();m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*c).normalize();for(i=0;i<e;i++){var q=j[i][h],r=j[i+1][h],l=j[i+1][h+1],s=j[i][h+1],t=n.clone(),p=n.clone(),v=m.clone(),w=m.clone(),u=k[i][h].clone(),E=k[i+1][h].clone(),x=k[i+1][h+1].clone(),A=k[i][h+1].clone();this.faces.push(new THREE.Face3(q,
r,s,[t,p,w]));this.faceVertexUvs[0].push([u,E,A]);this.faces.push(new THREE.Face3(r,l,s,[p.clone(),v,w.clone()]));this.faceVertexUvs[0].push([E.clone(),x,A.clone()])}}if(!1===f&&0<b){this.vertices.push(new THREE.Vector3(0,g,0));for(h=0;h<d;h++)q=j[0][h],r=j[0][h+1],l=this.vertices.length-1,t=new THREE.Vector3(0,1,0),p=new THREE.Vector3(0,1,0),v=new THREE.Vector3(0,1,0),u=k[0][h].clone(),E=k[0][h+1].clone(),x=new THREE.Vector2(E.x,0),this.faces.push(new THREE.Face3(q,r,l,[t,p,v])),this.faceVertexUvs[0].push([u,
E,x])}if(!1===f&&0<a){this.vertices.push(new THREE.Vector3(0,-g,0));for(h=0;h<d;h++)q=j[i][h+1],r=j[i][h],l=this.vertices.length-1,t=new THREE.Vector3(0,-1,0),p=new THREE.Vector3(0,-1,0),v=new THREE.Vector3(0,-1,0),u=k[i][h+1].clone(),E=k[i][h].clone(),x=new THREE.Vector2(E.x,1),this.faces.push(new THREE.Face3(q,r,l,[t,p,v])),this.faceVertexUvs[0].push([u,E,x])}this.computeCentroids();this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry=function(b,a){"undefined"!==typeof b&&(THREE.Geometry.call(this),b=b instanceof Array?b:[b],this.shapebb=b[b.length-1].getBoundingBox(),this.addShapeList(b,a),this.computeCentroids(),this.computeFaceNormals())};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(b,a){for(var c=b.length,d=0;d<c;d++)this.addShape(b[d],a)};
THREE.ExtrudeGeometry.prototype.addShape=function(b,a){function c(a,b,c){b||console.log("die");return b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d=THREE.ExtrudeGeometry.__v1,e=THREE.ExtrudeGeometry.__v2,f=THREE.ExtrudeGeometry.__v3,g=THREE.ExtrudeGeometry.__v4,h=THREE.ExtrudeGeometry.__v5,i=THREE.ExtrudeGeometry.__v6;d.set(a.x-b.x,a.y-b.y);e.set(a.x-c.x,a.y-c.y);d=d.normalize();e=e.normalize();f.set(-d.y,d.x);g.set(e.y,-e.x);h.copy(a).add(f);i.copy(a).add(g);if(h.equals(i))return g.clone();
h.copy(b).add(f);i.copy(c).add(g);f=d.dot(g);g=i.sub(h).dot(g);0===f&&(console.log("Either infinite or no solutions!"),0===g?console.log("Its finite solutions."):console.log("Too bad, no solutions."));g/=f;0>g?(b=Math.atan2(b.y-a.y,b.x-a.x),a=Math.atan2(c.y-a.y,c.x-a.x),b>a&&(a+=2*Math.PI),c=(b+a)/2,a=-Math.cos(c),c=-Math.sin(c),a=new THREE.Vector2(a,c)):a=d.multiplyScalar(g).add(h).sub(a).clone();return a}function e(c,d){var e,f;for(z=c.length;0<=--z;){e=z;f=z-1;0>f&&(f=c.length-1);for(var g=0,h=
q+2*k,g=0;g<h;g++){var i=M*g,j=M*(g+1),l=d+e+i,i=d+f+i,m=d+f+j,j=d+e+j,n=c,r=g,s=h,t=e,w=f,l=l+J,i=i+J,m=m+J,j=j+J;D.faces.push(new THREE.Face3(l,i,j,null,null,p));D.faces.push(new THREE.Face3(i,m,j,null,null,p));l=v.generateSideWallUV(D,b,n,a,l,i,m,j,r,s,t,w);D.faceVertexUvs[0].push([l[0],l[1],l[3]]);D.faceVertexUvs[0].push([l[1],l[2],l[3]])}}}function f(a,b,c){D.vertices.push(new THREE.Vector3(a,b,c))}function g(c,d,e,f){c+=J;d+=J;e+=J;D.faces.push(new THREE.Face3(c,d,e,null,null,t));c=f?v.generateBottomUV(D,
b,a,c,d,e):v.generateTopUV(D,b,a,c,d,e);D.faceVertexUvs[0].push(c)}var h=void 0!==a.amount?a.amount:100,i=void 0!==a.bevelThickness?a.bevelThickness:6,j=void 0!==a.bevelSize?a.bevelSize:i-2,k=void 0!==a.bevelSegments?a.bevelSegments:3,n=void 0!==a.bevelEnabled?a.bevelEnabled:!0,m=void 0!==a.curveSegments?a.curveSegments:12,q=void 0!==a.steps?a.steps:1,r=a.extrudePath,l,s=!1,t=a.material,p=a.extrudeMaterial,v=void 0!==a.UVGenerator?a.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,w,u,E,x;r&&(l=
r.getSpacedPoints(q),s=!0,n=!1,w=void 0!==a.frames?a.frames:new THREE.TubeGeometry.FrenetFrames(r,q,!1),u=new THREE.Vector3,E=new THREE.Vector3,x=new THREE.Vector3);n||(j=i=k=0);var A,y,F,D=this,J=this.vertices.length,m=b.extractPoints(m),H=m.shape,m=m.holes;if(r=!THREE.Shape.Utils.isClockWise(H)){H=H.reverse();y=0;for(F=m.length;y<F;y++)A=m[y],THREE.Shape.Utils.isClockWise(A)&&(m[y]=A.reverse());r=!1}var K=THREE.Shape.Utils.triangulateShape(H,m),r=H;y=0;for(F=m.length;y<F;y++)A=m[y],H=H.concat(A);
var G,B,I,C,M=H.length,O=K.length,P=[],z=0,L=r.length;G=L-1;for(B=z+1;z<L;z++,G++,B++)G===L&&(G=0),B===L&&(B=0),P[z]=d(r[z],r[G],r[B]);var R=[],N,Q=P.concat();y=0;for(F=m.length;y<F;y++){A=m[y];N=[];z=0;L=A.length;G=L-1;for(B=z+1;z<L;z++,G++,B++)G===L&&(G=0),B===L&&(B=0),N[z]=d(A[z],A[G],A[B]);R.push(N);Q=Q.concat(N)}for(G=0;G<k;G++){A=G/k;I=i*(1-A);B=j*Math.sin(A*Math.PI/2);z=0;for(L=r.length;z<L;z++)C=c(r[z],P[z],B),f(C.x,C.y,-I);y=0;for(F=m.length;y<F;y++){A=m[y];N=R[y];z=0;for(L=A.length;z<L;z++)C=
c(A[z],N[z],B),f(C.x,C.y,-I)}}B=j;for(z=0;z<M;z++)C=n?c(H[z],Q[z],B):H[z],s?(E.copy(w.normals[0]).multiplyScalar(C.x),u.copy(w.binormals[0]).multiplyScalar(C.y),x.copy(l[0]).add(E).add(u),f(x.x,x.y,x.z)):f(C.x,C.y,0);for(A=1;A<=q;A++)for(z=0;z<M;z++)C=n?c(H[z],Q[z],B):H[z],s?(E.copy(w.normals[A]).multiplyScalar(C.x),u.copy(w.binormals[A]).multiplyScalar(C.y),x.copy(l[A]).add(E).add(u),f(x.x,x.y,x.z)):f(C.x,C.y,h/q*A);for(G=k-1;0<=G;G--){A=G/k;I=i*(1-A);B=j*Math.sin(A*Math.PI/2);z=0;for(L=r.length;z<
L;z++)C=c(r[z],P[z],B),f(C.x,C.y,h+I);y=0;for(F=m.length;y<F;y++){A=m[y];N=R[y];z=0;for(L=A.length;z<L;z++)C=c(A[z],N[z],B),s?f(C.x,C.y+l[q-1].y,l[q-1].x+I):f(C.x,C.y,h+I)}}if(n){i=0*M;for(z=0;z<O;z++)h=K[z],g(h[2]+i,h[1]+i,h[0]+i,!0);i=M*(q+2*k);for(z=0;z<O;z++)h=K[z],g(h[0]+i,h[1]+i,h[2]+i,!1)}else{for(z=0;z<O;z++)h=K[z],g(h[2],h[1],h[0],!0);for(z=0;z<O;z++)h=K[z],g(h[0]+M*q,h[1]+M*q,h[2]+M*q,!1)}h=0;e(r,h);h+=r.length;y=0;for(F=m.length;y<F;y++)A=m[y],e(A,h),h+=A.length};
THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(b,a,c,d,e,f){a=b.vertices[e].x;e=b.vertices[e].y;c=b.vertices[f].x;f=b.vertices[f].y;return[new THREE.Vector2(b.vertices[d].x,b.vertices[d].y),new THREE.Vector2(a,e),new THREE.Vector2(c,f)]},generateBottomUV:function(b,a,c,d,e,f){return this.generateTopUV(b,a,c,d,e,f)},generateSideWallUV:function(b,a,c,d,e,f,g,h){var a=b.vertices[e].x,c=b.vertices[e].y,e=b.vertices[e].z,d=b.vertices[f].x,i=b.vertices[f].y,f=b.vertices[f].z,j=b.vertices[g].x,
k=b.vertices[g].y,g=b.vertices[g].z,n=b.vertices[h].x,m=b.vertices[h].y,b=b.vertices[h].z;return 0.01>Math.abs(c-i)?[new THREE.Vector2(a,1-e),new THREE.Vector2(d,1-f),new THREE.Vector2(j,1-g),new THREE.Vector2(n,1-b)]:[new THREE.Vector2(c,1-e),new THREE.Vector2(i,1-f),new THREE.Vector2(k,1-g),new THREE.Vector2(m,1-b)]}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2;THREE.ExtrudeGeometry.__v2=new THREE.Vector2;THREE.ExtrudeGeometry.__v3=new THREE.Vector2;THREE.ExtrudeGeometry.__v4=new THREE.Vector2;
THREE.ExtrudeGeometry.__v5=new THREE.Vector2;THREE.ExtrudeGeometry.__v6=new THREE.Vector2;THREE.ShapeGeometry=function(b,a){THREE.Geometry.call(this);!1===b instanceof Array&&(b=[b]);this.shapebb=b[b.length-1].getBoundingBox();this.addShapeList(b,a);this.computeCentroids();this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(b,a){for(var c=0,d=b.length;c<d;c++)this.addShape(b[c],a);return this};
THREE.ShapeGeometry.prototype.addShape=function(b,a){void 0===a&&(a={});var c=a.material,d=void 0===a.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:a.UVGenerator,e,f,g,h=this.vertices.length;e=b.extractPoints(void 0!==a.curveSegments?a.curveSegments:12);var i=e.shape,j=e.holes;if(!THREE.Shape.Utils.isClockWise(i)){i=i.reverse();e=0;for(f=j.length;e<f;e++)g=j[e],THREE.Shape.Utils.isClockWise(g)&&(j[e]=g.reverse())}var k=THREE.Shape.Utils.triangulateShape(i,j);e=0;for(f=j.length;e<f;e++)g=j[e],
i=i.concat(g);j=i.length;f=k.length;for(e=0;e<j;e++)g=i[e],this.vertices.push(new THREE.Vector3(g.x,g.y,0));for(e=0;e<f;e++)j=k[e],i=j[0]+h,g=j[1]+h,j=j[2]+h,this.faces.push(new THREE.Face3(i,g,j,null,null,c)),this.faceVertexUvs[0].push(d.generateBottomUV(this,b,a,i,g,j))};THREE.LatheGeometry=function(b,a,c,d){THREE.Geometry.call(this);for(var a=a||12,c=c||0,d=d||2*Math.PI,e=1/(b.length-1),f=1/a,g=0,h=a;g<=h;g++)for(var i=c+g*f*d,j=Math.cos(i),k=Math.sin(i),i=0,n=b.length;i<n;i++){var m=b[i],q=new THREE.Vector3;q.x=j*m.x-k*m.y;q.y=k*m.x+j*m.y;q.z=m.z;this.vertices.push(q)}c=b.length;g=0;for(h=a;g<h;g++){i=0;for(n=b.length-1;i<n;i++){var a=k=i+c*g,d=k+c,j=k+1+c,k=k+1,m=g*f,q=i*e,r=m+f,l=q+e;this.faces.push(new THREE.Face3(a,d,k));this.faceVertexUvs[0].push([new THREE.Vector2(m,
q),new THREE.Vector2(r,q),new THREE.Vector2(m,l)]);this.faces.push(new THREE.Face3(d,j,k));this.faceVertexUvs[0].push([new THREE.Vector2(r,q),new THREE.Vector2(r,l),new THREE.Vector2(m,l)])}}this.mergeVertices();this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry=function(b,a,c,d){THREE.Geometry.call(this);this.width=b;this.height=a;this.widthSegments=c||1;this.heightSegments=d||1;for(var e=b/2,f=a/2,c=this.widthSegments,d=this.heightSegments,g=c+1,h=d+1,i=this.width/c,j=this.height/d,k=new THREE.Vector3(0,0,1),b=0;b<h;b++)for(a=0;a<g;a++)this.vertices.push(new THREE.Vector3(a*i-e,-(b*j-f),0));for(b=0;b<d;b++)for(a=0;a<c;a++){var n=a+g*b,e=a+g*(b+1),f=a+1+g*(b+1),h=a+1+g*b,i=new THREE.Vector2(a/c,1-b/d),j=new THREE.Vector2(a/c,1-(b+1)/
d),m=new THREE.Vector2((a+1)/c,1-(b+1)/d),q=new THREE.Vector2((a+1)/c,1-b/d),n=new THREE.Face3(n,e,h);n.normal.copy(k);n.vertexNormals.push(k.clone(),k.clone(),k.clone());this.faces.push(n);this.faceVertexUvs[0].push([i,j,q]);n=new THREE.Face3(e,f,h);n.normal.copy(k);n.vertexNormals.push(k.clone(),k.clone(),k.clone());this.faces.push(n);this.faceVertexUvs[0].push([j.clone(),m,q.clone()])}this.computeCentroids()};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry=function(b,a,c,d,e,f){THREE.Geometry.call(this);for(var b=b||0,a=a||50,e=void 0!==e?e:0,f=void 0!==f?f:2*Math.PI,c=void 0!==c?Math.max(3,c):8,d=void 0!==d?Math.max(3,d):8,g,h=[],i=b,j=(a-b)/d,b=0;b<=d;b++){for(g=0;g<=c;g++){var k=new THREE.Vector3,n=e+g/c*f;k.x=i*Math.cos(n);k.y=i*Math.sin(n);this.vertices.push(k);h.push(new THREE.Vector2((k.x/a+1)/2,(k.y/a+1)/2))}i+=j}a=new THREE.Vector3(0,0,1);for(b=0;b<d;b++){e=b*c;for(g=0;g<=c;g++)n=g+e,f=n+b,j=n+c+b,k=n+c+1+b,this.faces.push(new THREE.Face3(f,
j,k,[a.clone(),a.clone(),a.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[j].clone(),h[k].clone()]),f=n+b,j=n+c+1+b,k=n+1+b,this.faces.push(new THREE.Face3(f,j,k,[a.clone(),a.clone(),a.clone()])),this.faceVertexUvs[0].push([h[f].clone(),h[j].clone(),h[k].clone()])}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry=function(b,a,c,d,e,f,g){THREE.Geometry.call(this);this.radius=b=b||50;this.widthSegments=a=Math.max(3,Math.floor(a)||8);this.heightSegments=c=Math.max(2,Math.floor(c)||6);this.phiStart=d=void 0!==d?d:0;this.phiLength=e=void 0!==e?e:2*Math.PI;this.thetaStart=f=void 0!==f?f:0;this.thetaLength=g=void 0!==g?g:Math.PI;var h,i,j=[],k=[];for(i=0;i<=c;i++){var n=[],m=[];for(h=0;h<=a;h++){var q=h/a,r=i/c,l=new THREE.Vector3;l.x=-b*Math.cos(d+q*e)*Math.sin(f+r*g);l.y=b*Math.cos(f+r*g);
l.z=b*Math.sin(d+q*e)*Math.sin(f+r*g);this.vertices.push(l);n.push(this.vertices.length-1);m.push(new THREE.Vector2(q,1-r))}j.push(n);k.push(m)}for(i=0;i<this.heightSegments;i++)for(h=0;h<this.widthSegments;h++){var a=j[i][h+1],c=j[i][h],d=j[i+1][h],e=j[i+1][h+1],f=this.vertices[a].clone().normalize(),g=this.vertices[c].clone().normalize(),n=this.vertices[d].clone().normalize(),m=this.vertices[e].clone().normalize(),q=k[i][h+1].clone(),r=k[i][h].clone(),l=k[i+1][h].clone(),s=k[i+1][h+1].clone();Math.abs(this.vertices[a].y)===
this.radius?(q.x=(q.x+r.x)/2,this.faces.push(new THREE.Face3(a,d,e,[f,n,m])),this.faceVertexUvs[0].push([q,l,s])):Math.abs(this.vertices[d].y)===this.radius?(l.x=(l.x+s.x)/2,this.faces.push(new THREE.Face3(a,c,d,[f,g,n])),this.faceVertexUvs[0].push([q,r,l])):(this.faces.push(new THREE.Face3(a,c,e,[f,g,m])),this.faceVertexUvs[0].push([q,r,s]),this.faces.push(new THREE.Face3(c,d,e,[g.clone(),n,m.clone()])),this.faceVertexUvs[0].push([r.clone(),l,s.clone()]))}this.computeCentroids();this.computeFaceNormals();
this.boundingSphere=new THREE.Sphere(new THREE.Vector3,b)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(b,a){var a=a||{},c=THREE.FontUtils.generateShapes(b,a);a.amount=void 0!==a.height?a.height:50;void 0===a.bevelThickness&&(a.bevelThickness=10);void 0===a.bevelSize&&(a.bevelSize=8);void 0===a.bevelEnabled&&(a.bevelEnabled=!1);THREE.ExtrudeGeometry.call(this,c,a)};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TorusGeometry=function(b,a,c,d,e){THREE.Geometry.call(this);this.radius=b||100;this.tube=a||40;this.radialSegments=c||8;this.tubularSegments=d||6;this.arc=e||2*Math.PI;e=new THREE.Vector3;b=[];a=[];for(c=0;c<=this.radialSegments;c++)for(d=0;d<=this.tubularSegments;d++){var f=d/this.tubularSegments*this.arc,g=2*c/this.radialSegments*Math.PI;e.x=this.radius*Math.cos(f);e.y=this.radius*Math.sin(f);var h=new THREE.Vector3;h.x=(this.radius+this.tube*Math.cos(g))*Math.cos(f);h.y=(this.radius+this.tube*
Math.cos(g))*Math.sin(f);h.z=this.tube*Math.sin(g);this.vertices.push(h);b.push(new THREE.Vector2(d/this.tubularSegments,c/this.radialSegments));a.push(h.clone().sub(e).normalize())}for(c=1;c<=this.radialSegments;c++)for(d=1;d<=this.tubularSegments;d++){var e=(this.tubularSegments+1)*c+d-1,f=(this.tubularSegments+1)*(c-1)+d-1,g=(this.tubularSegments+1)*(c-1)+d,h=(this.tubularSegments+1)*c+d,i=new THREE.Face3(e,f,h,[a[e].clone(),a[f].clone(),a[h].clone()]);this.faces.push(i);this.faceVertexUvs[0].push([b[e].clone(),
b[f].clone(),b[h].clone()]);i=new THREE.Face3(f,g,h,[a[f].clone(),a[g].clone(),a[h].clone()]);this.faces.push(i);this.faceVertexUvs[0].push([b[f].clone(),b[g].clone(),b[h].clone()])}this.computeCentroids();this.computeFaceNormals()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry=function(b,a,c,d,e,f,g){function h(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a),a=b/c*a,b=Math.cos(a),f=0.5*(d*(2+b))*f,g=0.5*d*(2+b)*g,d=0.5*e*d*Math.sin(a);return new THREE.Vector3(f,g,d)}THREE.Geometry.call(this);this.radius=b||100;this.tube=a||40;this.radialSegments=c||64;this.tubularSegments=d||8;this.p=e||2;this.q=f||3;this.heightScale=g||1;this.grid=Array(this.radialSegments);c=new THREE.Vector3;d=new THREE.Vector3;e=new THREE.Vector3;for(b=0;b<this.radialSegments;++b){this.grid[b]=
Array(this.tubularSegments);a=2*(b/this.radialSegments)*this.p*Math.PI;f=h(a,this.q,this.p,this.radius,this.heightScale);a=h(a+0.01,this.q,this.p,this.radius,this.heightScale);c.subVectors(a,f);d.addVectors(a,f);e.crossVectors(c,d);d.crossVectors(e,c);e.normalize();d.normalize();for(a=0;a<this.tubularSegments;++a){var i=2*(a/this.tubularSegments)*Math.PI,g=-this.tube*Math.cos(i),i=this.tube*Math.sin(i),j=new THREE.Vector3;j.x=f.x+g*d.x+i*e.x;j.y=f.y+g*d.y+i*e.y;j.z=f.z+g*d.z+i*e.z;this.grid[b][a]=
this.vertices.push(j)-1}}for(b=0;b<this.radialSegments;++b)for(a=0;a<this.tubularSegments;++a){var e=(b+1)%this.radialSegments,f=(a+1)%this.tubularSegments,c=this.grid[b][a],d=this.grid[e][a],e=this.grid[e][f],f=this.grid[b][f],g=new THREE.Vector2(b/this.radialSegments,a/this.tubularSegments),i=new THREE.Vector2((b+1)/this.radialSegments,a/this.tubularSegments),j=new THREE.Vector2((b+1)/this.radialSegments,(a+1)/this.tubularSegments),k=new THREE.Vector2(b/this.radialSegments,(a+1)/this.tubularSegments);
this.faces.push(new THREE.Face3(c,d,f));this.faceVertexUvs[0].push([g,i,k]);this.faces.push(new THREE.Face3(d,e,f));this.faceVertexUvs[0].push([i.clone(),j,k.clone()])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry=function(b,a,c,d,e){THREE.Geometry.call(this);this.path=b;this.segments=a||64;this.radius=c||1;this.radialSegments=d||8;this.closed=e||!1;this.grid=[];var f,g,d=this.segments+1,h,i,j,e=new THREE.Vector3,k,n,a=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed);k=a.normals;n=a.binormals;this.tangents=a.tangents;this.normals=k;this.binormals=n;for(a=0;a<d;a++){this.grid[a]=[];c=a/(d-1);j=b.getPointAt(c);f=k[a];g=n[a];for(c=0;c<this.radialSegments;c++)h=2*(c/this.radialSegments)*
Math.PI,i=-this.radius*Math.cos(h),h=this.radius*Math.sin(h),e.copy(j),e.x+=i*f.x+h*g.x,e.y+=i*f.y+h*g.y,e.z+=i*f.z+h*g.z,this.grid[a][c]=this.vertices.push(new THREE.Vector3(e.x,e.y,e.z))-1}for(a=0;a<this.segments;a++)for(c=0;c<this.radialSegments;c++)e=this.closed?(a+1)%this.segments:a+1,k=(c+1)%this.radialSegments,b=this.grid[a][c],d=this.grid[e][c],e=this.grid[e][k],k=this.grid[a][k],n=new THREE.Vector2(a/this.segments,c/this.radialSegments),f=new THREE.Vector2((a+1)/this.segments,c/this.radialSegments),
g=new THREE.Vector2((a+1)/this.segments,(c+1)/this.radialSegments),i=new THREE.Vector2(a/this.segments,(c+1)/this.radialSegments),this.faces.push(new THREE.Face3(b,d,k)),this.faceVertexUvs[0].push([n,f,i]),this.faces.push(new THREE.Face3(d,e,k)),this.faceVertexUvs[0].push([f.clone(),g,i.clone()]);this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);
THREE.TubeGeometry.FrenetFrames=function(b,a,c){new THREE.Vector3;var d=new THREE.Vector3;new THREE.Vector3;var e=[],f=[],g=[],h=new THREE.Vector3,i=new THREE.Matrix4,a=a+1,j,k,n;this.tangents=e;this.normals=f;this.binormals=g;for(j=0;j<a;j++)k=j/(a-1),e[j]=b.getTangentAt(k),e[j].normalize();f[0]=new THREE.Vector3;g[0]=new THREE.Vector3;b=Number.MAX_VALUE;j=Math.abs(e[0].x);k=Math.abs(e[0].y);n=Math.abs(e[0].z);j<=b&&(b=j,d.set(1,0,0));k<=b&&(b=k,d.set(0,1,0));n<=b&&d.set(0,0,1);h.crossVectors(e[0],
d).normalize();f[0].crossVectors(e[0],h);g[0].crossVectors(e[0],f[0]);for(j=1;j<a;j++)f[j]=f[j-1].clone(),g[j]=g[j-1].clone(),h.crossVectors(e[j-1],e[j]),1E-4<h.length()&&(h.normalize(),d=Math.acos(THREE.Math.clamp(e[j-1].dot(e[j]),-1,1)),f[j].applyMatrix4(i.makeRotationAxis(h,d))),g[j].crossVectors(e[j],f[j]);if(c){d=Math.acos(THREE.Math.clamp(f[0].dot(f[a-1]),-1,1));d/=a-1;0<e[0].dot(h.crossVectors(f[0],f[a-1]))&&(d=-d);for(j=1;j<a;j++)f[j].applyMatrix4(i.makeRotationAxis(e[j],d*j)),g[j].crossVectors(e[j],
f[j])}};THREE.PolyhedronGeometry=function(b,a,c,d){function e(a){var b=a.normalize().clone();b.index=h.vertices.push(b)-1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+0.5,a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+0.5;b.uv=new THREE.Vector2(c,1-a);return b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);d.centroid.add(a).add(b).add(c).divideScalar(3);h.faces.push(d);d=Math.atan2(d.centroid.z,-d.centroid.x);h.faceVertexUvs[0].push([g(a.uv,a,d),g(b.uv,b,d),
g(c.uv,c,d)])}function g(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+0.5,a.y));return a.clone()}THREE.Geometry.call(this);for(var c=c||1,d=d||0,h=this,i=0,j=b.length;i<j;i++)e(new THREE.Vector3(b[i][0],b[i][1],b[i][2]));for(var k=this.vertices,b=[],i=0,j=a.length;i<j;i++){var n=k[a[i][0]],m=k[a[i][1]],q=k[a[i][2]];b[i]=new THREE.Face3(n.index,m.index,q.index,[n.clone(),m.clone(),q.clone()])}i=0;for(j=b.length;i<j;i++){m=b[i];k=d;a=Math.pow(2,
k);Math.pow(4,k);for(var k=e(h.vertices[m.a]),n=e(h.vertices[m.b]),r=e(h.vertices[m.c]),m=[],q=0;q<=a;q++){m[q]=[];for(var l=e(k.clone().lerp(r,q/a)),s=e(n.clone().lerp(r,q/a)),t=a-q,p=0;p<=t;p++)m[q][p]=0==p&&q==a?l:e(l.clone().lerp(s,p/t))}for(q=0;q<a;q++)for(p=0;p<2*(a-q)-1;p++)k=Math.floor(p/2),0==p%2?f(m[q][k+1],m[q+1][k],m[q][k]):f(m[q][k+1],m[q+1][k+1],m[q+1][k])}i=0;for(j=this.faceVertexUvs[0].length;i<j;i++)d=this.faceVertexUvs[0][i],b=d[0].x,a=d[1].x,k=d[2].x,n=Math.max(b,Math.max(a,k)),
m=Math.min(b,Math.min(a,k)),0.9<n&&0.1>m&&(0.2>b&&(d[0].x+=1),0.2>a&&(d[1].x+=1),0.2>k&&(d[2].x+=1));i=0;for(j=this.vertices.length;i<j;i++)this.vertices[i].multiplyScalar(c);this.mergeVertices();this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry=function(b,a){this.radius=b;this.detail=a;var c=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,c,0],[1,c,0],[-1,-c,0],[1,-c,0],[0,-1,c],[0,1,c],[0,-1,-c],[0,1,-c],[c,0,-1],[c,0,1],[-c,0,-1],[-c,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],b,a)};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry=function(b,a){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],b,a)};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(b,a){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],b,a)};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry=function(b,a,c){THREE.Geometry.call(this);var d=this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,h,i,j,k=a+1;for(g=0;g<=c;g++){j=g/c;for(h=0;h<=a;h++)i=h/a,i=b(i,j),d.push(i)}var n,m,q,r;for(g=0;g<c;g++)for(h=0;h<a;h++)b=g*k+h,d=g*k+h+1,j=(g+1)*k+h+1,i=(g+1)*k+h,n=new THREE.Vector2(h/a,g/c),m=new THREE.Vector2((h+1)/a,g/c),q=new THREE.Vector2((h+1)/a,(g+1)/c),r=new THREE.Vector2(h/a,(g+1)/c),e.push(new THREE.Face3(b,d,i)),f.push([n,m,r]),e.push(new THREE.Face3(d,j,i)),
f.push([m.clone(),q,r.clone()]);this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.AxisHelper=function(b){var b=b||1,a=new THREE.Geometry;a.vertices.push(new THREE.Vector3,new THREE.Vector3(b,0,0),new THREE.Vector3,new THREE.Vector3(0,b,0),new THREE.Vector3,new THREE.Vector3(0,0,b));a.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,a,b,THREE.LinePieces)};
THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.ArrowHelper=function(b,a,c,d,e,f){THREE.Object3D.call(this);void 0===d&&(d=16776960);void 0===c&&(c=1);void 0===e&&(e=0.2*c);void 0===f&&(f=0.2*e);this.position=a;a=new THREE.Geometry;a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(0,1,0));this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:d}));this.line.matrixAutoUpdate=!1;this.add(this.line);a=new THREE.CylinderGeometry(0,0.5,1,5,1);a.applyMatrix((new THREE.Matrix4).makeTranslation(0,-0.5,0));this.cone=
new THREE.Mesh(a,new THREE.MeshBasicMaterial({color:d}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(b);this.setLength(c,e,f)};THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(){var b=new THREE.Vector3,a;return function(c){0.99999<c.y?this.quaternion.set(0,0,0,1):-0.99999>c.y?this.quaternion.set(1,0,0,0):(b.set(c.z,0,-c.x).normalize(),a=Math.acos(c.y),this.quaternion.setFromAxisAngle(b,a))}}();
THREE.ArrowHelper.prototype.setLength=function(b,a,c){void 0===a&&(a=0.2*b);void 0===c&&(c=0.2*a);this.line.scale.set(1,b,1);this.line.updateMatrix();this.cone.scale.set(c,a,c);this.cone.position.y=b;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(b){this.line.material.color.setHex(b);this.cone.material.color.setHex(b)};THREE.BoxHelper=function(b){var a=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=a;var c=new THREE.Geometry;c.vertices.push(a[0],a[1],a[1],a[2],a[2],a[3],a[3],a[0],a[4],a[5],a[5],a[6],a[6],a[7],a[7],a[4],a[0],a[4],a[1],a[5],a[2],a[6],a[3],a[7]);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);
void 0!==b&&this.update(b)};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);
THREE.BoxHelper.prototype.update=function(b){var a=b.geometry;null===a.boundingBox&&a.computeBoundingBox();var c=a.boundingBox.min,a=a.boundingBox.max,d=this.vertices;d[0].set(a.x,a.y,a.z);d[1].set(c.x,a.y,a.z);d[2].set(c.x,c.y,a.z);d[3].set(a.x,c.y,a.z);d[4].set(a.x,a.y,c.z);d[5].set(c.x,a.y,c.z);d[6].set(c.x,c.y,c.z);d[7].set(a.x,c.y,c.z);this.geometry.computeBoundingSphere();this.geometry.verticesNeedUpdate=!0;this.matrixAutoUpdate=!1;this.matrixWorld=b.matrixWorld};THREE.BoundingBoxHelper=function(b,a){var c=void 0!==a?a:8947848;this.object=b;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.CubeGeometry(1,1,1),new THREE.MeshBasicMaterial({color:c,wireframe:!0}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(b){function a(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new THREE.Vector3);d.colors.push(new THREE.Color(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new THREE.Geometry,e=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),f={};a("n1","n2",16755200);a("n2","n4",16755200);a("n4","n3",16755200);a("n3","n1",16755200);a("f1","f2",16755200);a("f2","f4",16755200);a("f4","f3",16755200);a("f3","f1",16755200);a("n1","f1",16755200);
a("n2","f2",16755200);a("n3","f3",16755200);a("n4","f4",16755200);a("p","n1",16711680);a("p","n2",16711680);a("p","n3",16711680);a("p","n4",16711680);a("u1","u2",43775);a("u2","u3",43775);a("u3","u1",43775);a("c","t",16777215);a("p","c",3355443);a("cn1","cn2",3355443);a("cn3","cn4",3355443);a("cf1","cf2",3355443);a("cf3","cf4",3355443);THREE.Line.call(this,d,e,THREE.LinePieces);this.camera=b;this.matrixWorld=b.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=f;this.update()};
THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);
THREE.CameraHelper.prototype.update=function(){var b=new THREE.Vector3,a=new THREE.Camera,c=new THREE.Projector;return function(){function d(d,g,h,i){b.set(g,h,i);c.unprojectVector(b,a);d=e.pointMap[d];if(void 0!==d){g=0;for(h=d.length;g<h;g++)e.geometry.vertices[d[g]].copy(b)}}var e=this;a.projectionMatrix.copy(this.camera.projectionMatrix);d("c",0,0,-1);d("t",0,0,1);d("n1",-1,-1,-1);d("n2",1,-1,-1);d("n3",-1,1,-1);d("n4",1,1,-1);d("f1",-1,-1,1);d("f2",1,-1,1);d("f3",-1,1,1);d("f4",1,1,1);d("u1",
0.7,1.1,-1);d("u2",-0.7,1.1,-1);d("u3",0,2,-1);d("cf1",-1,0,1);d("cf2",1,0,1);d("cf3",0,-1,1);d("cf4",0,1,1);d("cn1",-1,0,-1);d("cn2",1,0,-1);d("cn3",0,-1,-1);d("cn4",0,1,-1);this.geometry.verticesNeedUpdate=!0}}();THREE.DirectionalLightHelper=function(b,a){THREE.Object3D.call(this);this.light=b;this.light.updateMatrixWorld();this.matrixWorld=b.matrixWorld;this.matrixAutoUpdate=!1;var a=a||1,c=new THREE.PlaneGeometry(a,a),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Mesh(c,d);this.add(this.lightPlane);c=new THREE.Geometry;c.vertices.push(new THREE.Vector3);c.vertices.push(new THREE.Vector3);d=new THREE.LineBasicMaterial({fog:!1});
d.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(c,d);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};
THREE.DirectionalLightHelper.prototype.update=function(){var b=new THREE.Vector3,a=new THREE.Vector3,c=new THREE.Vector3;return function(){b.setFromMatrixPosition(this.light.matrixWorld);a.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(a,b);this.lightPlane.lookAt(c);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(c);this.targetLine.geometry.verticesNeedUpdate=!0;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();THREE.EdgesHelper=function(b,a){var c=void 0!==a?a:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry,i=b.geometry.clone();i.mergeVertices();i.computeFaceNormals();for(var j=i.vertices,i=i.faces,k=0,n=0,m=i.length;n<m;n++)for(var q=i[n],r=0;3>r;r++){d[0]=q[g[r]];d[1]=q[g[(r+1)%3]];d.sort(f);var l=d.toString();void 0===e[l]?(e[l]={vert1:d[0],vert2:d[1],face1:n,face2:void 0},k++):e[l].face2=n}h.addAttribute("position",Float32Array,2*k,3);d=h.attributes.position.array;
f=0;for(l in e)if(g=e[l],void 0===g.face2||0.9999>i[g.face1].normal.dot(i[g.face2].normal))k=j[g.vert1],d[f++]=k.x,d[f++]=k.y,d[f++]=k.z,k=j[g.vert2],d[f++]=k.x,d[f++]=k.y,d[f++]=k.z;THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.matrixWorld=b.matrixWorld};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper=function(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;for(var b=void 0!==c?c:16776960,d=void 0!==d?d:1,a=new THREE.Geometry,c=0,e=this.object.geometry.faces.length;c<e;c++)a.vertices.push(new THREE.Vector3),a.vertices.push(new THREE.Vector3);THREE.Line.call(this,a,new THREE.LineBasicMaterial({color:b,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.FaceNormalsHelper.prototype.update=function(){var b=new THREE.Vector3;return function(){this.object.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var a=this.geometry.vertices,c=this.object.geometry.faces,d=this.object.matrixWorld,e=0,f=c.length;e<f;e++){var g=c[e];b.copy(g.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var h=2*e;a[h].copy(g.centroid).applyMatrix4(d);a[h+1].addVectors(a[h],b)}this.geometry.verticesNeedUpdate=
!0;return this}}();THREE.GridHelper=function(b,a){var c=new THREE.Geometry,d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var e=-b;e<=b;e+=a){c.vertices.push(new THREE.Vector3(-b,0,e),new THREE.Vector3(b,0,e),new THREE.Vector3(e,0,-b),new THREE.Vector3(e,0,b));var f=0===e?this.color1:this.color2;c.colors.push(f,f,f,f)}THREE.Line.call(this,c,d,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);
THREE.GridHelper.prototype.setColors=function(b,a){this.color1.set(b);this.color2.set(a);this.geometry.colorsNeedUpdate=!0};THREE.HemisphereLightHelper=function(b,a){THREE.Object3D.call(this);this.light=b;this.light.updateMatrixWorld();this.matrixWorld=b.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new THREE.Color,new THREE.Color];var c=new THREE.SphereGeometry(a,4,2);c.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var d=0;8>d;d++)c.faces[d].color=this.colors[4>d?0:1];d=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(c,d);this.add(this.lightSphere);
this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};
THREE.HemisphereLightHelper.prototype.update=function(){var b=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(b.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=!0}}();THREE.PointLightHelper=function(b,a){this.light=b;this.light.updateMatrixWorld();var c=new THREE.SphereGeometry(a,4,2),d=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,d);this.matrixWorld=this.light.matrixWorld;this.matrixAutoUpdate=!1};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};
THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SpotLightHelper=function(b){THREE.Object3D.call(this);this.light=b;this.light.updateMatrixWorld();this.matrixWorld=b.matrixWorld;this.matrixAutoUpdate=!1;b=new THREE.CylinderGeometry(0,1,1,8,1,!0);b.applyMatrix((new THREE.Matrix4).makeTranslation(0,-0.5,0));b.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var a=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(b,a);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);
THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var b=new THREE.Vector3,a=new THREE.Vector3;return function(){var c=this.light.distance?this.light.distance:1E4,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);b.setFromMatrixPosition(this.light.matrixWorld);a.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(a.sub(b));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;for(var a=void 0!==c?c:16711680,d=void 0!==d?d:1,c=new THREE.Geometry,b=b.geometry.faces,e=0,f=b.length;e<f;e++)for(var g=0,h=b[e].vertexNormals.length;g<h;g++)c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.normalMatrix=new THREE.Matrix3;this.update()};
THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.VertexNormalsHelper.prototype.update=function(){var b=new THREE.Vector3;return function(){var a=["a","b","c","d"];this.object.updateMatrixWorld(!0);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var c=this.geometry.vertices,d=this.object.geometry.vertices,e=this.object.geometry.faces,f=this.object.matrixWorld,g=0,h=0,i=e.length;h<i;h++)for(var j=e[h],k=0,n=j.vertexNormals.length;k<n;k++){var m=j.vertexNormals[k];c[g].copy(d[j[a[k]]]).applyMatrix4(f);b.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);
b.add(c[g]);g+=1;c[g].copy(b);g+=1}this.geometry.verticesNeedUpdate=!0;return this}}();THREE.VertexTangentsHelper=function(b,a,c,d){this.object=b;this.size=void 0!==a?a:1;for(var a=void 0!==c?c:255,d=void 0!==d?d:1,c=new THREE.Geometry,b=b.geometry.faces,e=0,f=b.length;e<f;e++)for(var g=0,h=b[e].vertexTangents.length;g<h;g++)c.vertices.push(new THREE.Vector3),c.vertices.push(new THREE.Vector3);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:a,linewidth:d}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);
THREE.VertexTangentsHelper.prototype.update=function(){var b=new THREE.Vector3;return function(){var a=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var c=this.geometry.vertices,d=this.object.geometry.vertices,e=this.object.geometry.faces,f=this.object.matrixWorld,g=0,h=0,i=e.length;h<i;h++)for(var j=e[h],k=0,n=j.vertexTangents.length;k<n;k++){var m=j.vertexTangents[k];c[g].copy(d[j[a[k]]]).applyMatrix4(f);b.copy(m).transformDirection(f).multiplyScalar(this.size);b.add(c[g]);g+=1;c[g].copy(b);
g+=1}this.geometry.verticesNeedUpdate=!0;return this}}();THREE.WireframeHelper=function(b,a){var c=void 0!==a?a:16777215,d=[0,0],e={},f=function(a,b){return a-b},g=["a","b","c"],h=new THREE.BufferGeometry;if(b.geometry instanceof THREE.Geometry){for(var i=b.geometry.vertices,j=b.geometry.faces,k=0,n=new Uint32Array(6*j.length),m=0,q=j.length;m<q;m++)for(var r=j[m],l=0;3>l;l++){d[0]=r[g[l]];d[1]=r[g[(l+1)%3]];d.sort(f);var s=d.toString();void 0===e[s]&&(n[2*k]=d[0],n[2*k+1]=d[1],e[s]=!0,k++)}h.addAttribute("position",Float32Array,2*k,3);d=h.attributes.position.array;
m=0;for(q=k;m<q;m++)for(l=0;2>l;l++)k=i[n[2*m+l]],g=6*m+3*l,d[g+0]=k.x,d[g+1]=k.y,d[g+2]=k.z}else if(b.geometry instanceof THREE.BufferGeometry&&void 0!==b.geometry.attributes.index){for(var i=b.geometry.attributes.position.array,q=b.geometry.attributes.index.array,j=b.geometry.offsets,k=0,n=new Uint32Array(2*q.length),r=0,t=j.length;r<t;++r)for(var l=j[r].start,s=j[r].count,g=j[r].index,m=l,p=l+s;m<p;m+=3)for(l=0;3>l;l++)d[0]=g+q[m+l],d[1]=g+q[m+(l+1)%3],d.sort(f),s=d.toString(),void 0===e[s]&&(n[2*
k]=d[0],n[2*k+1]=d[1],e[s]=!0,k++);h.addAttribute("position",Float32Array,2*k,3);d=h.attributes.position.array;m=0;for(q=k;m<q;m++)for(l=0;2>l;l++)g=6*m+3*l,k=3*n[2*m+l],d[g+0]=i[k],d[g+1]=i[k+1],d[g+2]=i[k+2]}else if(b.geometry instanceof THREE.BufferGeometry){i=b.geometry.attributes.position.array;k=i.length/3;n=k/3;h.addAttribute("position",Float32Array,2*k,3);d=h.attributes.position.array;m=0;for(q=n;m<q;m++)for(l=0;3>l;l++)g=18*m+6*l,n=9*m+3*l,d[g+0]=i[n],d[g+1]=i[n+1],d[g+2]=i[n+2],k=9*m+3*
((l+1)%3),d[g+3]=i[k],d[g+4]=i[k+1],d[g+5]=i[k+2]}THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:c}),THREE.LinePieces);this.matrixAutoUpdate=!1;this.matrixWorld=b.matrixWorld};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare=function(b,a,c,d,e){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;void 0!==b&&this.add(b,a,c,d,e)};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);
THREE.LensFlare.prototype.add=function(b,a,c,d,e,f){void 0===a&&(a=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new THREE.Color(16777215));void 0===d&&(d=THREE.NormalBlending);c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:b,size:a,distance:c,x:0,y:0,z:0,scale:1,rotation:1,opacity:f,color:e,blending:d})};
THREE.LensFlare.prototype.updateLensFlares=function(){var b,a=this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(b=0;b<a;b++)c=this.lensFlares[b],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=0.25*c.x*Math.PI,c.rotation+=0.25*(c.wantedRotation-c.rotation)};THREE.MorphBlendMesh=function(b,a){THREE.Mesh.call(this,b,a);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,c/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);
THREE.MorphBlendMesh.prototype.createAnimation=function(b,a,c,d){a={startFrame:a,endFrame:c,length:c-a+1,fps:d,duration:(c-a)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[b]=a;this.animationsList.push(a)};
THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(b){for(var a=/([a-z]+)(\d+)/,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f].name.match(a);if(h&&1<h.length){var i=h[1];d[i]||(d[i]={start:Infinity,end:-Infinity});h=d[i];f<h.start&&(h.start=f);f>h.end&&(h.end=f);c||(c=i)}}for(i in d)h=d[i],this.createAnimation(i,h.start,h.end,b);this.firstAnimation=c};
THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(b){if(b=this.animationsMap[b])b.direction=1,b.directionBackwards=!1};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(b){if(b=this.animationsMap[b])b.direction=-1,b.directionBackwards=!0};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(b,a){var c=this.animationsMap[b];c&&(c.fps=a,c.duration=(c.end-c.start)/c.fps)};
THREE.MorphBlendMesh.prototype.setAnimationDuration=function(b,a){var c=this.animationsMap[b];c&&(c.duration=a,c.fps=(c.end-c.start)/c.duration)};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(b,a){var c=this.animationsMap[b];c&&(c.weight=a)};THREE.MorphBlendMesh.prototype.setAnimationTime=function(b,a){var c=this.animationsMap[b];c&&(c.time=a)};THREE.MorphBlendMesh.prototype.getAnimationTime=function(b){var a=0;if(b=this.animationsMap[b])a=b.time;return a};
THREE.MorphBlendMesh.prototype.getAnimationDuration=function(b){var a=-1;if(b=this.animationsMap[b])a=b.duration;return a};THREE.MorphBlendMesh.prototype.playAnimation=function(b){var a=this.animationsMap[b];a?(a.time=0,a.active=!0):console.warn("animation["+b+"] undefined")};THREE.MorphBlendMesh.prototype.stopAnimation=function(b){if(b=this.animationsMap[b])b.active=!1};
THREE.MorphBlendMesh.prototype.update=function(b){for(var a=0,c=this.animationsList.length;a<c;a++){var d=this.animationsList[a];if(d.active){var e=d.duration/d.length;d.time+=d.direction*b;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.startFrame+THREE.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;
f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);this.morphTargetInfluences[d.currentFrame]=e*g;this.morphTargetInfluences[d.lastFrame]=(1-e)*g}}};THREE.LensFlarePlugin=function(){function b(b,c){var d=a.createProgram(),e=a.createShader(a.FRAGMENT_SHADER),f=a.createShader(a.VERTEX_SHADER),g="precision "+c+" float;\n";a.shaderSource(e,g+b.fragmentShader);a.shaderSource(f,g+b.vertexShader);a.compileShader(e);a.compileShader(f);a.attachShader(d,e);a.attachShader(d,f);a.linkProgram(d);return d}var a,c,d,e,f,g,h,i,j,k,n,m,q;this.init=function(r){a=r.context;c=r;d=r.getPrecision();e=new Float32Array(16);f=new Uint16Array(6);r=0;e[r++]=-1;e[r++]=-1;
e[r++]=0;e[r++]=0;e[r++]=1;e[r++]=-1;e[r++]=1;e[r++]=0;e[r++]=1;e[r++]=1;e[r++]=1;e[r++]=1;e[r++]=-1;e[r++]=1;e[r++]=0;e[r++]=1;r=0;f[r++]=0;f[r++]=1;f[r++]=2;f[r++]=0;f[r++]=2;f[r++]=3;g=a.createBuffer();h=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,g);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,h);a.bufferData(a.ELEMENT_ARRAY_BUFFER,f,a.STATIC_DRAW);i=a.createTexture();j=a.createTexture();a.bindTexture(a.TEXTURE_2D,i);a.texImage2D(a.TEXTURE_2D,0,a.RGB,16,16,
0,a.RGB,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.bindTexture(a.TEXTURE_2D,j);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,16,16,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);0>=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(k=!1,n=b(THREE.ShaderFlares.lensFlare,d)):(k=!0,n=b(THREE.ShaderFlares.lensFlareVertexTexture,d));m={};q={};m.vertex=a.getAttribLocation(n,"position");m.uv=a.getAttribLocation(n,"uv");q.renderType=a.getUniformLocation(n,"renderType");q.map=a.getUniformLocation(n,"map");q.occlusionMap=a.getUniformLocation(n,"occlusionMap");q.opacity=
a.getUniformLocation(n,"opacity");q.color=a.getUniformLocation(n,"color");q.scale=a.getUniformLocation(n,"scale");q.rotation=a.getUniformLocation(n,"rotation");q.screenPosition=a.getUniformLocation(n,"screenPosition")};this.render=function(b,d,e,f){var b=b.__webglFlares,p=b.length;if(p){var v=new THREE.Vector3,w=f/e,u=0.5*e,E=0.5*f,x=16/f,A=new THREE.Vector2(x*w,x),y=new THREE.Vector3(1,1,0),F=new THREE.Vector2(1,1),D=q,x=m;a.useProgram(n);a.enableVertexAttribArray(m.vertex);a.enableVertexAttribArray(m.uv);
a.uniform1i(D.occlusionMap,0);a.uniform1i(D.map,1);a.bindBuffer(a.ARRAY_BUFFER,g);a.vertexAttribPointer(x.vertex,2,a.FLOAT,!1,16,0);a.vertexAttribPointer(x.uv,2,a.FLOAT,!1,16,8);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,h);a.disable(a.CULL_FACE);a.depthMask(!1);var J,H,K,G,B;for(J=0;J<p;J++)if(x=16/f,A.set(x*w,x),G=b[J],v.set(G.matrixWorld.elements[12],G.matrixWorld.elements[13],G.matrixWorld.elements[14]),v.applyMatrix4(d.matrixWorldInverse),v.applyProjection(d.projectionMatrix),y.copy(v),F.x=y.x*u+u,
F.y=y.y*E+E,k||0<F.x&&F.x<e&&0<F.y&&F.y<f){a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,i);a.copyTexImage2D(a.TEXTURE_2D,0,a.RGB,F.x-8,F.y-8,16,16,0);a.uniform1i(D.renderType,0);a.uniform2f(D.scale,A.x,A.y);a.uniform3f(D.screenPosition,y.x,y.y,y.z);a.disable(a.BLEND);a.enable(a.DEPTH_TEST);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,j);a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,F.x-8,F.y-8,16,16,0);a.uniform1i(D.renderType,1);a.disable(a.DEPTH_TEST);
a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,i);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0);G.positionScreen.copy(y);G.customUpdateCallback?G.customUpdateCallback(G):G.updateLensFlares();a.uniform1i(D.renderType,2);a.enable(a.BLEND);H=0;for(K=G.lensFlares.length;H<K;H++)B=G.lensFlares[H],0.001<B.opacity&&0.001<B.scale&&(y.x=B.x,y.y=B.y,y.z=B.z,x=B.size*B.scale/f,A.x=x*w,A.y=x,a.uniform3f(D.screenPosition,y.x,y.y,y.z),a.uniform2f(D.scale,A.x,A.y),a.uniform1f(D.rotation,B.rotation),a.uniform1f(D.opacity,
B.opacity),a.uniform3f(D.color,B.color.r,B.color.g,B.color.b),c.setBlending(B.blending,B.blendEquation,B.blendSrc,B.blendDst),c.setTexture(B.texture,1),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0))}a.enable(a.CULL_FACE);a.enable(a.DEPTH_TEST);a.depthMask(!0)}}};THREE.ShadowMapPlugin=function(){var b,a,c,d,e,f,g=new THREE.Frustum,h=new THREE.Matrix4,i=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3;this.init=function(g){b=g.context;a=g;var g=THREE.ShaderLib.depthRGBA,h=THREE.UniformsUtils.clone(g.uniforms);c=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h});d=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0});e=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,
vertexShader:g.vertexShader,uniforms:h,skinning:!0});f=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0,skinning:!0});c._shadowPass=!0;d._shadowPass=!0;e._shadowPass=!0;f._shadowPass=!0};this.render=function(b,c){a.shadowMapEnabled&&a.shadowMapAutoUpdate&&this.update(b,c)};this.update=function(n,m){var q,r,l,s,t,p,v,w,u,E=[];s=0;b.clearColor(1,1,1,1);b.disable(b.BLEND);b.enable(b.CULL_FACE);b.frontFace(b.CCW);a.shadowMapCullFace===THREE.CullFaceFront?
b.cullFace(b.FRONT):b.cullFace(b.BACK);a.setDepthTest(!0);q=0;for(r=n.__lights.length;q<r;q++)if(l=n.__lights[q],l.castShadow)if(l instanceof THREE.DirectionalLight&&l.shadowCascade)for(t=0;t<l.shadowCascadeCount;t++){var x;if(l.shadowCascadeArray[t])x=l.shadowCascadeArray[t];else{u=l;v=t;x=new THREE.DirectionalLight;x.isVirtual=!0;x.onlyShadow=!0;x.castShadow=!0;x.shadowCameraNear=u.shadowCameraNear;x.shadowCameraFar=u.shadowCameraFar;x.shadowCameraLeft=u.shadowCameraLeft;x.shadowCameraRight=u.shadowCameraRight;
x.shadowCameraBottom=u.shadowCameraBottom;x.shadowCameraTop=u.shadowCameraTop;x.shadowCameraVisible=u.shadowCameraVisible;x.shadowDarkness=u.shadowDarkness;x.shadowBias=u.shadowCascadeBias[v];x.shadowMapWidth=u.shadowCascadeWidth[v];x.shadowMapHeight=u.shadowCascadeHeight[v];x.pointsWorld=[];x.pointsFrustum=[];w=x.pointsWorld;p=x.pointsFrustum;for(var A=0;8>A;A++)w[A]=new THREE.Vector3,p[A]=new THREE.Vector3;w=u.shadowCascadeNearZ[v];u=u.shadowCascadeFarZ[v];p[0].set(-1,-1,w);p[1].set(1,-1,w);p[2].set(-1,
1,w);p[3].set(1,1,w);p[4].set(-1,-1,u);p[5].set(1,-1,u);p[6].set(-1,1,u);p[7].set(1,1,u);x.originalCamera=m;p=new THREE.Gyroscope;p.position=l.shadowCascadeOffset;p.add(x);p.add(x.target);m.add(p);l.shadowCascadeArray[t]=x;console.log("Created virtualLight",x)}v=l;w=t;u=v.shadowCascadeArray[w];u.position.copy(v.position);u.target.position.copy(v.target.position);u.lookAt(u.target);u.shadowCameraVisible=v.shadowCameraVisible;u.shadowDarkness=v.shadowDarkness;u.shadowBias=v.shadowCascadeBias[w];p=v.shadowCascadeNearZ[w];
v=v.shadowCascadeFarZ[w];u=u.pointsFrustum;u[0].z=p;u[1].z=p;u[2].z=p;u[3].z=p;u[4].z=v;u[5].z=v;u[6].z=v;u[7].z=v;E[s]=x;s++}else E[s]=l,s++;q=0;for(r=E.length;q<r;q++){l=E[q];l.shadowMap||(t=THREE.LinearFilter,a.shadowMapType===THREE.PCFSoftShadowMap&&(t=THREE.NearestFilter),l.shadowMap=new THREE.WebGLRenderTarget(l.shadowMapWidth,l.shadowMapHeight,{minFilter:t,magFilter:t,format:THREE.RGBAFormat}),l.shadowMapSize=new THREE.Vector2(l.shadowMapWidth,l.shadowMapHeight),l.shadowMatrix=new THREE.Matrix4);
if(!l.shadowCamera){if(l instanceof THREE.SpotLight)l.shadowCamera=new THREE.PerspectiveCamera(l.shadowCameraFov,l.shadowMapWidth/l.shadowMapHeight,l.shadowCameraNear,l.shadowCameraFar);else if(l instanceof THREE.DirectionalLight)l.shadowCamera=new THREE.OrthographicCamera(l.shadowCameraLeft,l.shadowCameraRight,l.shadowCameraTop,l.shadowCameraBottom,l.shadowCameraNear,l.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}n.add(l.shadowCamera);!0===n.autoUpdate&&n.updateMatrixWorld()}l.shadowCameraVisible&&
!l.cameraHelper&&(l.cameraHelper=new THREE.CameraHelper(l.shadowCamera),l.shadowCamera.add(l.cameraHelper));if(l.isVirtual&&x.originalCamera==m){t=m;s=l.shadowCamera;p=l.pointsFrustum;u=l.pointsWorld;i.set(Infinity,Infinity,Infinity);j.set(-Infinity,-Infinity,-Infinity);for(v=0;8>v;v++)w=u[v],w.copy(p[v]),THREE.ShadowMapPlugin.__projector.unprojectVector(w,t),w.applyMatrix4(s.matrixWorldInverse),w.x<i.x&&(i.x=w.x),w.x>j.x&&(j.x=w.x),w.y<i.y&&(i.y=w.y),w.y>j.y&&(j.y=w.y),w.z<i.z&&(i.z=w.z),w.z>j.z&&
(j.z=w.z);s.left=i.x;s.right=j.x;s.top=j.y;s.bottom=i.y;s.updateProjectionMatrix()}s=l.shadowMap;p=l.shadowMatrix;t=l.shadowCamera;t.position.setFromMatrixPosition(l.matrixWorld);k.setFromMatrixPosition(l.target.matrixWorld);t.lookAt(k);t.updateMatrixWorld();t.matrixWorldInverse.getInverse(t.matrixWorld);l.cameraHelper&&(l.cameraHelper.visible=l.shadowCameraVisible);l.shadowCameraVisible&&l.cameraHelper.update();p.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);p.multiply(t.projectionMatrix);p.multiply(t.matrixWorldInverse);
h.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);g.setFromMatrix(h);a.setRenderTarget(s);a.clear();u=n.__webglObjects;l=0;for(s=u.length;l<s;l++)if(v=u[l],p=v.object,v.render=!1,p.visible&&p.castShadow&&(!(p instanceof THREE.Mesh||p instanceof THREE.ParticleSystem)||!p.frustumCulled||g.intersectsObject(p)))p._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,p.matrixWorld),v.render=!0;l=0;for(s=u.length;l<s;l++)v=u[l],v.render&&(p=v.object,v=v.buffer,A=p.material instanceof THREE.MeshFaceMaterial?
p.material.materials[0]:p.material,w=0<p.geometry.morphTargets.length&&A.morphTargets,A=p instanceof THREE.SkinnedMesh&&A.skinning,w=p.customDepthMaterial?p.customDepthMaterial:A?w?f:e:w?d:c,v instanceof THREE.BufferGeometry?a.renderBufferDirect(t,n.__lights,null,w,v,p):a.renderBuffer(t,n.__lights,null,w,v,p));u=n.__webglObjectsImmediate;l=0;for(s=u.length;l<s;l++)v=u[l],p=v.object,p.visible&&p.castShadow&&(p._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,p.matrixWorld),a.renderImmediateObject(t,
n.__lights,null,c,p))}q=a.getClearColor();r=a.getClearAlpha();b.clearColor(q.r,q.g,q.b,r);b.enable(b.BLEND);a.shadowMapCullFace===THREE.CullFaceFront&&b.cullFace(b.BACK)}};THREE.ShadowMapPlugin.__projector=new THREE.Projector;THREE.SpritePlugin=function(){var b,a,c,d,e,f,g,h,i,j,k,n,m,q,r,l,s;function t(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}var p,v,w,u,E,x,A,y;this.init=function(t){p=t.context;v=t;u=new Float32Array([-0.5,-0.5,0,0,0.5,-0.5,1,0,0.5,0.5,1,1,-0.5,0.5,0,1]);E=new Uint16Array([0,1,2,0,2,3]);x=p.createBuffer();A=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,x);p.bufferData(p.ARRAY_BUFFER,u,p.STATIC_DRAW);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,A);p.bufferData(p.ELEMENT_ARRAY_BUFFER,E,p.STATIC_DRAW);var t=p.createProgram(),
D=p.createShader(p.VERTEX_SHADER),J=p.createShader(p.FRAGMENT_SHADER);p.shaderSource(D,["precision "+v.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
p.shaderSource(J,["precision "+v.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
p.compileShader(D);p.compileShader(J);p.attachShader(t,D);p.attachShader(t,J);p.linkProgram(t);y=t;l=p.getAttribLocation(y,"position");s=p.getAttribLocation(y,"uv");b=p.getUniformLocation(y,"uvOffset");a=p.getUniformLocation(y,"uvScale");c=p.getUniformLocation(y,"rotation");d=p.getUniformLocation(y,"scale");e=p.getUniformLocation(y,"color");f=p.getUniformLocation(y,"map");g=p.getUniformLocation(y,"opacity");h=p.getUniformLocation(y,"modelViewMatrix");i=p.getUniformLocation(y,"projectionMatrix");j=
p.getUniformLocation(y,"fogType");k=p.getUniformLocation(y,"fogDensity");n=p.getUniformLocation(y,"fogNear");m=p.getUniformLocation(y,"fogFar");q=p.getUniformLocation(y,"fogColor");r=p.getUniformLocation(y,"alphaTest");t=document.createElement("canvas");t.width=8;t.height=8;D=t.getContext("2d");D.fillStyle="#ffffff";D.fillRect(0,0,t.width,t.height);w=new THREE.Texture(t);w.needsUpdate=!0};this.render=function(u,D){var E=u.__webglSprites,H=E.length;if(H){p.useProgram(y);p.enableVertexAttribArray(l);
p.enableVertexAttribArray(s);p.disable(p.CULL_FACE);p.enable(p.BLEND);p.bindBuffer(p.ARRAY_BUFFER,x);p.vertexAttribPointer(l,2,p.FLOAT,!1,16,0);p.vertexAttribPointer(s,2,p.FLOAT,!1,16,8);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,A);p.uniformMatrix4fv(i,!1,D.projectionMatrix.elements);p.activeTexture(p.TEXTURE0);p.uniform1i(f,0);var K=0,G=0,B=u.fog;B?(p.uniform3f(q,B.color.r,B.color.g,B.color.b),B instanceof THREE.Fog?(p.uniform1f(n,B.near),p.uniform1f(m,B.far),p.uniform1i(j,1),G=K=1):B instanceof THREE.FogExp2&&
(p.uniform1f(k,B.density),p.uniform1i(j,2),G=K=2)):(p.uniform1i(j,0),G=K=0);for(var I,C,M=[],B=0;B<H;B++)I=E[B],!1!==I.visible&&(I._modelViewMatrix.multiplyMatrices(D.matrixWorldInverse,I.matrixWorld),I.z=-I._modelViewMatrix.elements[14]);E.sort(t);for(B=0;B<H;B++)I=E[B],!1!==I.visible&&(C=I.material,p.uniform1f(r,C.alphaTest),p.uniformMatrix4fv(h,!1,I._modelViewMatrix.elements),M[0]=I.scale.x,M[1]=I.scale.y,I=u.fog&&C.fog?G:0,K!==I&&(p.uniform1i(j,I),K=I),null!==C.map?(p.uniform2f(b,C.map.offset.x,
C.map.offset.y),p.uniform2f(a,C.map.repeat.x,C.map.repeat.y)):(p.uniform2f(b,0,0),p.uniform2f(a,1,1)),p.uniform1f(g,C.opacity),p.uniform3f(e,C.color.r,C.color.g,C.color.b),p.uniform1f(c,C.rotation),p.uniform2fv(d,M),v.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),v.setDepthTest(C.depthTest),v.setDepthWrite(C.depthWrite),C.map&&C.map.image&&C.map.image.width?v.setTexture(C.map,0):v.setTexture(w,0),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0));p.enable(p.CULL_FACE)}}};THREE.DepthPassPlugin=function(){this.enabled=!1;this.renderTarget=null;var b,a,c,d,e,f,g=new THREE.Frustum,h=new THREE.Matrix4;this.init=function(g){b=g.context;a=g;var g=THREE.ShaderLib.depthRGBA,h=THREE.UniformsUtils.clone(g.uniforms);c=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h});d=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0});e=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,
vertexShader:g.vertexShader,uniforms:h,skinning:!0});f=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:!0,skinning:!0});c._shadowPass=!0;d._shadowPass=!0;e._shadowPass=!0;f._shadowPass=!0};this.render=function(a,b){this.enabled&&this.update(a,b)};this.update=function(i,j){var k,n,m,q,r,l;b.clearColor(1,1,1,1);b.disable(b.BLEND);a.setDepthTest(!0);!0===i.autoUpdate&&i.updateMatrixWorld();j.matrixWorldInverse.getInverse(j.matrixWorld);h.multiplyMatrices(j.projectionMatrix,
j.matrixWorldInverse);g.setFromMatrix(h);a.setRenderTarget(this.renderTarget);a.clear();l=i.__webglObjects;k=0;for(n=l.length;k<n;k++)if(m=l[k],r=m.object,m.render=!1,r.visible&&(!(r instanceof THREE.Mesh||r instanceof THREE.ParticleSystem)||!r.frustumCulled||g.intersectsObject(r)))r._modelViewMatrix.multiplyMatrices(j.matrixWorldInverse,r.matrixWorld),m.render=!0;var s;k=0;for(n=l.length;k<n;k++)if(m=l[k],m.render&&(r=m.object,m=m.buffer,!(r instanceof THREE.ParticleSystem)||r.customDepthMaterial))(s=
r.material instanceof THREE.MeshFaceMaterial?r.material.materials[0]:r.material)&&a.setMaterialFaces(r.material),q=0<r.geometry.morphTargets.length&&s.morphTargets,s=r instanceof THREE.SkinnedMesh&&s.skinning,q=r.customDepthMaterial?r.customDepthMaterial:s?q?f:e:q?d:c,m instanceof THREE.BufferGeometry?a.renderBufferDirect(j,i.__lights,null,q,m,r):a.renderBuffer(j,i.__lights,null,q,m,r);l=i.__webglObjectsImmediate;k=0;for(n=l.length;k<n;k++)m=l[k],r=m.object,r.visible&&(r._modelViewMatrix.multiplyMatrices(j.matrixWorldInverse,
r.matrixWorld),a.renderImmediateObject(j,i.__lights,null,c,r));k=a.getClearColor();n=a.getClearAlpha();b.clearColor(k.r,k.g,k.b,n);b.enable(b.BLEND)}};THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}};
